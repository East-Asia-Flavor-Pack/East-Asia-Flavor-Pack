je_manchus_and_han = {
	icon = "gfx/interface/icons/event_icons/event_portrait.dds"
	
	group = je_group_historical_content

	immediate = {
		set_variable = {
			name = china_manchu_support_var
			value = 70
		}
		set_variable = {
			name = china_han_support_var
			value = 30
		}
		set_variable = {
			name = china_manchu_power_var
			value = 70
		}
		# 한과 만주 정치력 퍼센티지 근사
		set_local_variable = { name = man_pol_str value = 0 }
		set_local_variable = { name = han_pol_str value = 0 }
		set_local_variable = { name = man_pop_num value = 0 }
		set_local_variable = { name = han_pop_num value = 0 }
		every_scope_pop = {
			if = {
				limit = { culture = cu:han }
				change_local_variable = {
					name = han_pol_str
					add = pop_pol_str_from_wealth
					# multiply = this.population
				}
				change_local_variable = {
					name = han_pop_num
					add = 1
				}
			}
			else_if = {
				limit = { culture = cu:manchu }
				change_local_variable = {
					name = man_pol_str
					add = pop_pol_str_from_wealth
					# multiply = this.population
				}
				change_local_variable = {
					name = man_pop_num
					add = 1
				}
			}
		}
		change_local_variable = {
			name = han_pol_str
			divide = local_var:han_pop_num
			
		}
		change_local_variable = {
			name = man_pol_str
			divide = local_var:man_pop_num
		}
		set_variable = {
			name = man_pop_num
			value = local_var:man_pop_num
		}
		set_variable = {
			name = han_pop_num
			value = local_var:han_pop_num
		}
		remove_local_variable = han_pop_num
		remove_local_variable = man_pop_num
		change_local_variable = {
			name = han_pol_str
			multiply = han_percent
		}
		change_local_variable = {
			name = man_pol_str
			multiply = man_percent
		}
		set_variable = {
			name = man_pol_str
			value = {
				value = local_var:man_pol_str
				multiply = 60 # 임시
			}
		}
		set_variable = {
			name = han_pol_str
			value = local_var:han_pol_str
		}
		## 정말 별로다
		# 차별에 따른 정치력 감소
		change_local_variable = {
			name = han_pol_str
			multiply = {
				value = 1
				add = modifier:state_political_strength_from_discrimination_mult
			}
		}
		#
		set_variable = {
			name = china_manchu_power_var_d
			value = {
				value = {
					value = 100
					subtract = var:china_manchu_power_var
				}
				subtract = {
					value = local_var:han_pol_str
					divide = {
						value = local_var:man_pol_str
						add = local_var:han_pol_str
					}
					multiply = 100
				}
				subtract = var:china_manchu_power_var
				add = {
					value = local_var:man_pol_str
					divide = {
						value = local_var:man_pol_str
						add = local_var:han_pol_str
					}
					multiply = 100
				}
				multiply = 0.001
			}
		}
		set_variable = {
			name = man_percent
			value = man_percent
		}
		set_variable = {
			name = han_percent
			value = han_percent
		}
		remove_local_variable = man_pol_str
		remove_local_variable = han_pol_str
		
	}

	invalid = {
		custom_tooltip = {
			text = china_shatters_tt
			has_global_variable = china_shatters
		}
	}

	on_invalid = {
	}

	complete = {
		NOT = { has_law = law_type:law_racial_segregation }
	}

	on_complete = {
	}

	modifiers_while_active = {
		manchus_above_all
	}
	
	on_monthly_pulse = {
		effect = {
			# 한과 만주 정치력 퍼센티지 근사
			set_local_variable = { name = man_pol_str value = 0 }
			set_local_variable = { name = han_pol_str value = 0 }
			set_local_variable = { name = man_pop_num value = 0 }
			set_local_variable = { name = han_pop_num value = 0 }
			every_scope_pop = {
				if = {
					limit = { culture = cu:han }
					change_local_variable = {
						name = han_pol_str
						add = pop_pol_str_from_wealth
						# multiply = this.population
					}
					change_local_variable = {
						name = han_pop_num
						add = 1
					}
				}
				else_if = {
					limit = { culture = cu:manchu }
					change_local_variable = {
						name = man_pol_str
						add = pop_pol_str_from_wealth
						# multiply = this.population
					}
					change_local_variable = {
						name = man_pop_num
						add = 1
					}
				}
			}
			change_local_variable = {
				name = han_pol_str
				divide = local_var:han_pop_num
				
			}
			change_local_variable = {
				name = man_pol_str
				divide = local_var:man_pop_num
			}
			set_variable = {
				name = man_pop_num
				value = local_var:man_pop_num
			}
			set_variable = {
				name = han_pop_num
				value = local_var:han_pop_num
			}
			remove_local_variable = han_pop_num
			remove_local_variable = man_pop_num
			change_local_variable = {
				name = han_pol_str
				multiply = han_percent
			}
			change_local_variable = {
				name = man_pol_str
				multiply = man_percent
			}
			set_variable = {
				name = man_pol_str
				value = {
					value = local_var:man_pol_str
					multiply = 60 # 임시
				}
			}
			set_variable = {
				name = han_pol_str
				value = local_var:han_pol_str
			}
			## 정말 별로다
			# 차별에 따른 정치력 감소
			change_local_variable = {
				name = han_pol_str
				multiply = {
					value = 1
					add = modifier:state_political_strength_from_discrimination_mult
				}
			}
			#
			set_variable = {
				name = china_manchu_power_var_d
				value = {
					value = {
						value = 100
						subtract = var:china_manchu_power_var
					}
					subtract = {
						value = local_var:han_pol_str
						divide = {
							value = local_var:man_pol_str
							add = local_var:han_pol_str
						}
						multiply = 100
					}
					subtract = var:china_manchu_power_var
					add = {
						value = local_var:man_pol_str
						divide = {
							value = local_var:man_pol_str
							add = local_var:han_pol_str
						}
						multiply = 100
					}
					multiply = 0.001
				}
			}
			set_variable = {
				name = man_percent
				value = man_percent
			}
			set_variable = {
				name = han_percent
				value = han_percent
			}
			remove_local_variable = man_pol_str
			remove_local_variable = han_pol_str
			change_variable = {
				name = china_manchu_power_var
				add = var:china_manchu_power_var_d
			}
		}
	}

	on_yearly_pulse = {
		effect = {
			if = {
				limit = {
					has_technology_researched = nationalism
					NOT = { has_variable = manhan1 }
				}
				set_variable = manhan1
				trigger_event = {
					id = manchus_and_han_events.1
					months = { 0 12 }
				}
			}
			if = {
				limit = {
					has_technology_researched = pan-nationalism
					NOT = { has_variable = manhan2 }
				}
				set_variable = manhan2
				trigger_event = {
					id = manchus_and_han_events.2
					months = { 12 60 }
				}
			}
			if = {
				limit = { has_variable = manhan1 }
				random_list = {
					40 = {}
					5 = {
						modifier = {
							if = {
								limit = { cu:han = { culture_is_discriminated_in = ROOT } }
								multiply = 2
							}
						}
						modifier = {
							if = {
								limit = { has_variable = manhan2 }
								multiply = 2
							}
						}
						modifier = {
							if = {
								limit = { has_law = law_type:law_landed_voting }
								multiply = 0.9
							}
						}
						modifier = {
							if = {
								limit = { has_law = law_type:law_census_voting }
								multiply = 0.8
							}
						}
						modifier = {
							if = {
								limit = { has_law = law_type:law_wealth_voting }
								multiply = 0.7
							}
						}
						modifier = {
							if = {
								limit = { has_law = law_type:law_universal_suffrage }
								multiply = 0.6
							}
						}
						trigger_event = {
							id = manchus_and_han_events.3
							months = { 0 12 }
						}
					}
				}
			}
		}
	}

	progress_desc = je_manchus_and_han_progress

	status_desc = je_manchus_and_han_status

	weight = 1000
	should_be_pinned_by_default = no
}
