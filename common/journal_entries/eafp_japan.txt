# ID명, 변수명은 기본적으로 일본어 음차합니다.
# weight = 12000 최중요저널 10000 중요저널 8000 일반 5000 별 의미없음

# 막번체제

je_bakuhantaisei = {
	icon = "gfx/interface/icons/alert_icons/revolution.dds"

	group = je_group_bakuhantaisei

	scripted_progress_bar = bakuhantaisei_bakufu_authority_progress_bar

	scripted_button = appoint_tairo_button

	immediate = {
		
	}

	status_desc = {
		first_valid = {
			triggered_desc = { 
				desc = je_bakuhantaisei_desc_start
				trigger = {
					scope:journal_entry = {
						"scripted_bar_progress(bakuhantaisei_bakufu_authority_progress_bar)" >= 3600
					}
				}
			}
			triggered_desc = { 
				desc = je_bakuhantaisei_desc_very_low
				trigger = {
					scope:journal_entry = {
						"scripted_bar_progress(bakuhantaisei_bakufu_authority_progress_bar)" >= 3200
					}
				}
			}
			triggered_desc = { 
				desc = je_bakuhantaisei_desc_low
				trigger = {
					scope:journal_entry = {
						"scripted_bar_progress(bakuhantaisei_bakufu_authority_progress_bar)" >= 2400
					}
				}
			}
			triggered_desc = { 
				desc = je_bakuhantaisei_desc_medium
				trigger = {
					scope:journal_entry = {
						"scripted_bar_progress(bakuhantaisei_bakufu_authority_progress_bar)" >= 1600
					}
				}
			}
			triggered_desc = { 
				desc = je_bakuhantaisei_desc_high
				trigger = {
					scope:journal_entry = {
						"scripted_bar_progress(bakuhantaisei_bakufu_authority_progress_bar)" >= 800
					}
				}
			}
			desc = je_bakuhantaisei_desc_very_high
		}
	}

	complete = { 
		custom_tooltip = {
			text = je_bakuhantaisei_complete_tt
			has_variable = bakufu_kaikaku_complete_var
		}
	}

	on_complete = { 
		# TODO
	}

	fail = {
		scope:journal_entry = {
			"scripted_bar_progress(bakuhantaisei_bakufu_authority_progress_bar)" <= 0
		}
	}

	on_fail = {
		custom_tooltip = {
			text = je_bakuhantaisei_on_fail_tt
			trigger_event = eafp_japan.3001 # 대정봉환
		}
	}

	on_monthly_pulse = {
		effect = {
			every_scope_character = {
				limit = {
					has_variable = eafp_bakuhantaisei_politician_influence
				}
				change_variable = {
					name = eafp_bakuhantaisei_politician_influence
					add = eafp_bakuhantaisei_politician_influence_monthly_add
				}
			}
		}
	}

	on_yearly_pulse = {
		effect = {
			every_scope_character = { # 막부 정치인이기만 한 인물 사망 판정
				limit = {
					has_variable = eafp_bakuhantaisei_politician_influence
					is_busy = yes # immortal 판정 trigger는 없음. (원래)

					trigger_if = {
						limit = { modifier:character_health_add >= 1 }
						age >= {
							value = define:NCharacters|CHARACTER_LIFE_EXPECTANCY_BASE_YEARS
							add = var:CHARACTER_LIFE_EXPECTANCY_STDDEV_value
							add = {
								value = modifier:character_health_add
								add = -1
								multiply = define:NCharacters|CHARACTER_LIFE_EXPECTANCY_DELTA_YEARS_ABOVE_BASELINE
							}
						}
					}
					trigger_else = {
						age >= {
							value = define:NCharacters|CHARACTER_LIFE_EXPECTANCY_BASE_YEARS
							add = var:CHARACTER_LIFE_EXPECTANCY_STDDEV_value
							add = {
								value = modifier:character_health_add
								add = -1
								multiply = define:NCharacters|CHARACTER_LIFE_EXPECTANCY_DELTA_YEARS_BELOW_BASELINE
							}
						}
					}
				}
				trigger_event = {
					id = eafp_japan.9
					days = { 30 364 }
				}
			}
		}
	}
	
	transferable = yes

	weight = 12000

	should_be_pinned_by_default = yes
}

je_bakuhantaisei_TOHOKU = {
	icon = "gfx/interface/icons/law_icons/land_based_taxation.dds"

	group = je_group_bakuhantaisei

	scripted_progress_bar = bakuhantaisei_TOHOKU_loyalty_progress_bar
	scripted_progress_bar = bakuhantaisei_TOHOKU_independency_progress_bar
	scripted_progress_bar = bakuhantaisei_TOHOKU_goryo_progress_bar

	scripted_button = expand_goryo_TOHOKU_button
	scripted_button = reduce_goryo_TOHOKU_button
	scripted_button = show_bakufu_authority_TOHOKU_button
	scripted_button = forced_tokorogae_TOHOKU_button

	scripted_button = reduce_nidome_TOHOKU_button
	scripted_button = reduce_nidome2_TOHOKU_button

	immediate = {
		
	}

	on_weekly_pulse = {
		effect = {
			je_bakuhantaisei_STATE_weekly_pulse = { STATE = TOHOKU }
		}
	}

	fail = {
		custom_tooltip = {
			text = je_bakuhantaisei_STATE_fail_tt
			has_variable = assign_tobaku_hans_var
		}
	}

	on_fail = {
		je_bakuhantaisei_STATE_clear = { STATE = TOHOKU }
	}

	invalid = {
		NOT = { exists = s:STATE_TOHOKU.region_state:JAP }
	}

	on_invalid = {
		je_bakuhantaisei_STATE_clear = { STATE = TOHOKU }
	}

	progress_desc = je_bakuhantaisei_TOHOKU_progress

	transferable = yes

	weight = 10000

	should_be_pinned_by_default = no
}
je_bakuhantaisei_KANTO = {
	icon = "gfx/interface/icons/law_icons/land_based_taxation.dds"

	group = je_group_bakuhantaisei

	scripted_progress_bar = bakuhantaisei_KANTO_loyalty_progress_bar
	scripted_progress_bar = bakuhantaisei_KANTO_independency_progress_bar
	scripted_progress_bar = bakuhantaisei_KANTO_goryo_progress_bar

	scripted_button = expand_goryo_KANTO_button
	scripted_button = reduce_goryo_KANTO_button
	scripted_button = show_bakufu_authority_KANTO_button
	scripted_button = forced_tokorogae_KANTO_button

	scripted_button = reduce_nidome_KANTO_button
	scripted_button = reduce_nidome2_KANTO_button

	immediate = {
		
	}

	on_weekly_pulse = {
		effect = {
			je_bakuhantaisei_STATE_weekly_pulse = { STATE = KANTO }
		}
	}

	fail = {
		custom_tooltip = {
			text = je_bakuhantaisei_STATE_fail_tt
			has_variable = assign_tobaku_hans_var
		}
	}

	on_fail = {
		je_bakuhantaisei_STATE_clear = { STATE = KANTO }
	}

	invalid = {
		NOT = { exists = s:STATE_KANTO.region_state:JAP }
	}

	on_invalid = {
		je_bakuhantaisei_STATE_clear = { STATE = KANTO }
	}

	progress_desc = je_bakuhantaisei_KANTO_progress

	transferable = yes

	weight = 10000

	should_be_pinned_by_default = no
}
je_bakuhantaisei_CHUBU = {
	icon = "gfx/interface/icons/law_icons/land_based_taxation.dds"

	group = je_group_bakuhantaisei

	scripted_progress_bar = bakuhantaisei_CHUBU_loyalty_progress_bar
	scripted_progress_bar = bakuhantaisei_CHUBU_independency_progress_bar
	scripted_progress_bar = bakuhantaisei_CHUBU_goryo_progress_bar

	scripted_button = expand_goryo_CHUBU_button
	scripted_button = reduce_goryo_CHUBU_button
	scripted_button = show_bakufu_authority_CHUBU_button
	scripted_button = forced_tokorogae_CHUBU_button

	scripted_button = reduce_nidome_CHUBU_button
	scripted_button = reduce_nidome2_CHUBU_button

	immediate = {
		
	}

	on_weekly_pulse = {
		effect = {
			je_bakuhantaisei_STATE_weekly_pulse = { STATE = CHUBU }
		}
	}

	fail = {
		custom_tooltip = {
			text = je_bakuhantaisei_STATE_fail_tt
			has_variable = assign_tobaku_hans_var
		}
	}

	on_fail = {
		je_bakuhantaisei_STATE_clear = { STATE = CHUBU }
	}

	invalid = {
		NOT = { exists = s:STATE_CHUBU.region_state:JAP }
	}

	on_invalid = {
		je_bakuhantaisei_STATE_clear = { STATE = CHUBU }
	}

	progress_desc = je_bakuhantaisei_CHUBU_progress

	transferable = yes

	weight = 10000

	should_be_pinned_by_default = no
}
je_bakuhantaisei_KANSAI = {
	icon = "gfx/interface/icons/law_icons/land_based_taxation.dds"

	group = je_group_bakuhantaisei

	scripted_progress_bar = bakuhantaisei_KANSAI_loyalty_progress_bar
	scripted_progress_bar = bakuhantaisei_KANSAI_independency_progress_bar
	scripted_progress_bar = bakuhantaisei_KANSAI_goryo_progress_bar

	scripted_button = expand_goryo_KANSAI_button
	scripted_button = reduce_goryo_KANSAI_button
	scripted_button = show_bakufu_authority_KANSAI_button
	scripted_button = forced_tokorogae_KANSAI_button

	scripted_button = reduce_nidome_KANSAI_button
	scripted_button = reduce_nidome2_KANSAI_button

	immediate = {
		
	}

	on_weekly_pulse = {
		effect = {
			je_bakuhantaisei_STATE_weekly_pulse = { STATE = KANSAI }
		}
	}

	fail = {
		custom_tooltip = {
			text = je_bakuhantaisei_STATE_fail_tt
			has_variable = assign_tobaku_hans_var
		}
	}

	on_fail = {
		je_bakuhantaisei_STATE_clear = { STATE = KANSAI }
	}

	invalid = {
		NOT = { exists = s:STATE_KANSAI.region_state:JAP }
	}

	on_invalid = {
		je_bakuhantaisei_STATE_clear = { STATE = KANSAI }
	}

	progress_desc = je_bakuhantaisei_KANSAI_progress

	transferable = yes

	weight = 10000

	should_be_pinned_by_default = no
}
je_bakuhantaisei_KYUSHU = {
	icon = "gfx/interface/icons/law_icons/land_based_taxation.dds"

	group = je_group_bakuhantaisei

	scripted_progress_bar = bakuhantaisei_KYUSHU_loyalty_progress_bar
	scripted_progress_bar = bakuhantaisei_KYUSHU_independency_progress_bar
	scripted_progress_bar = bakuhantaisei_KYUSHU_goryo_progress_bar

	scripted_button = expand_goryo_KYUSHU_button
	scripted_button = reduce_goryo_KYUSHU_button
	scripted_button = show_bakufu_authority_KYUSHU_button
	scripted_button = forced_tokorogae_KYUSHU_button

	scripted_button = reduce_nidome_KYUSHU_button
	scripted_button = reduce_nidome2_KYUSHU_button

	immediate = {
		
	}

	on_weekly_pulse = {
		effect = {
			je_bakuhantaisei_STATE_weekly_pulse = { STATE = KYUSHU }
		}
	}

	fail = {
		custom_tooltip = {
			text = je_bakuhantaisei_STATE_fail_tt
			has_variable = assign_tobaku_hans_var
		}
	}

	on_fail = {
		je_bakuhantaisei_STATE_clear = { STATE = KYUSHU }
	}

	invalid = {
		NOT = { exists = s:STATE_KYUSHU.region_state:JAP }
	}

	on_invalid = {
		je_bakuhantaisei_STATE_clear = { STATE = KYUSHU }
	}

	progress_desc = je_bakuhantaisei_KYUSHU_progress

	transferable = yes

	weight = 10000

	should_be_pinned_by_default = no
}
je_bakuhantaisei_CHUGOKU = {
	icon = "gfx/interface/icons/law_icons/land_based_taxation.dds"

	group = je_group_bakuhantaisei

	scripted_progress_bar = bakuhantaisei_CHUGOKU_loyalty_progress_bar
	scripted_progress_bar = bakuhantaisei_CHUGOKU_independency_progress_bar
	scripted_progress_bar = bakuhantaisei_CHUGOKU_goryo_progress_bar

	scripted_button = expand_goryo_CHUGOKU_button
	scripted_button = reduce_goryo_CHUGOKU_button
	scripted_button = show_bakufu_authority_CHUGOKU_button
	scripted_button = forced_tokorogae_CHUGOKU_button

	scripted_button = reduce_nidome_CHUGOKU_button
	scripted_button = reduce_nidome2_CHUGOKU_button

	immediate = {
		
	}

	on_weekly_pulse = {
		effect = {
			je_bakuhantaisei_STATE_weekly_pulse = { STATE = CHUGOKU }
		}
	}

	fail = {
		custom_tooltip = {
			text = je_bakuhantaisei_STATE_fail_tt
			has_variable = assign_tobaku_hans_var
		}
	}

	on_fail = {
		je_bakuhantaisei_STATE_clear = { STATE = CHUGOKU }
	}

	invalid = {
		NOT = { exists = s:STATE_CHUGOKU.region_state:JAP }
	}

	on_invalid = {
		je_bakuhantaisei_STATE_clear = { STATE = CHUGOKU }
	}

	progress_desc = je_bakuhantaisei_CHUGOKU_progress

	transferable = yes

	weight = 10000

	should_be_pinned_by_default = no
}
je_bakuhantaisei_SHIKOKU = {
	icon = "gfx/interface/icons/law_icons/land_based_taxation.dds"

	group = je_group_bakuhantaisei

	scripted_progress_bar = bakuhantaisei_SHIKOKU_loyalty_progress_bar
	scripted_progress_bar = bakuhantaisei_SHIKOKU_independency_progress_bar
	scripted_progress_bar = bakuhantaisei_SHIKOKU_goryo_progress_bar

	scripted_button = expand_goryo_SHIKOKU_button
	scripted_button = reduce_goryo_SHIKOKU_button
	scripted_button = show_bakufu_authority_SHIKOKU_button
	scripted_button = forced_tokorogae_SHIKOKU_button

	scripted_button = reduce_nidome_SHIKOKU_button
	scripted_button = reduce_nidome2_SHIKOKU_button

	immediate = {
		
	}

	on_weekly_pulse = {
		effect = {
			je_bakuhantaisei_STATE_weekly_pulse = { STATE = SHIKOKU }
		}
	}

	fail = {
		custom_tooltip = {
			text = je_bakuhantaisei_STATE_fail_tt
			has_variable = assign_tobaku_hans_var
		}
	}

	on_fail = {
		je_bakuhantaisei_STATE_clear = { STATE = SHIKOKU }
	}

	invalid = {
		NOT = { exists = s:STATE_SHIKOKU.region_state:JAP }
	}

	on_invalid = {
		je_bakuhantaisei_STATE_clear = { STATE = SHIKOKU }
	}

	progress_desc = je_bakuhantaisei_SHIKOKU_progress

	transferable = yes

	weight = 10000

	should_be_pinned_by_default = no
}

# 홋카이도

je_hokkaido = {
	icon = "gfx/interface/icons/law_icons/frontier_colonization.dds"

	group = je_group_historical_content

	scripted_progress_bar = hokkaido_progress_bar

	scripted_button = make_into_shogunate_domain_button
	scripted_button = strengthen_merchant_surveillance_button
	scripted_button = encourage_ezo_japanization_button
	scripted_button = construct_hokkaido_castle_button

	immediate = {
		s:STATE_HOKKAIDO.region_state:JAP = {
			add_modifier = disorganized_bashoukeoisei_modifier
			add_modifier = matsumae_han_modifier
		}
	}

	complete = {
		s:STATE_HOKKAIDO.region_state:JAP.state_population >= 200000
		scope:journal_entry = { is_goal_complete = yes }
	}

	on_complete = {
		#trigger_event = { 임시로 막음 TODO
		#	id = eafp_japan.1000
		#}
		custom_tooltip = {
			text = hokkaido_complete_tt
			#set_variable = hokkaido_name_var TODO
		}
	}

	on_monthly_pulse = {
		random_events = {
			1 = hokkaido.5
			1 = hokkaido.6
			22 = 0
		}
	}

	timeout = 7000

	weight = 8000

}

# 텐포 대기근

je_tenpo_famine = {
	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	group = je_group_historical_content

	immediate = {
		# 텐포 대기근 변동치는 history에서
		# 이미 구호소 운영중
		set_variable = {
			name = sukuigoya_for_tenpo
			value = 2
		}
		add_modifier = {
			name = modifier_sukuigoya_for_tenpo
			multiplier = var:sukuigoya_for_tenpo
		}
		set_variable = {
			name = sukuigoya_for_tenpo_accumulation
			value = 0
		}
		trigger_event = {
			id = tenpo_famine.2
			months = 1
		}
		trigger_event = {
			id = tenpo_famine.5
			days = 448 # 1년 83일
		}
	}

	scripted_button = install_sukuigoya_button
	scripted_button = expand_sukuigoya_button
	scripted_button = close_sukuigoya_button
	scripted_button = reduce_sukuigoya_button

	status_desc = je_tenpo_famine_status

	on_monthly_pulse = {
		effect = {
			if = {
				limit = { has_variable = sukuigoya_for_tenpo }
				change_variable = {
					name = sukuigoya_for_tenpo_accumulation
					add = var:sukuigoya_for_tenpo
				}
			}
		}
		random_events = {
			chance_of_no_event = {
				value = 2
				if = {
					limit = { has_variable = sukuigoya_for_tenpo }
					add = var:sukuigoya_for_tenpo
				}
			}
			1 = 0
			1 = tenpo_famine.4
		}
	}

	complete = {
		NOT = {
			any_scope_state = {
				state_is_in_japan = yes
				OR = {
					state_region = { has_harvest_condition = flood }
					has_famine = yes
				}
			}
		}
	}

	on_complete = {
		trigger_event = tenpo_famine.99
	}

	weight = 10000
	should_be_pinned_by_default = yes
}

# 막부 개혁

je_bakufu_kaikaku = {
	icon = "gfx/interface/icons/objectives/egalitarian_society.dds"

	group = je_group_historical_content

	scripted_progress_bar = bakufu_kaikaku_progress_bar
	scripted_progress_bar = bakufu_kaikaku_hitotsubashiha_approval_progress_bar
	scripted_progress_bar = bakufu_kaikaku_nankiha_approval_progress_bar

	scripted_button = japan_kaikakuha_button
	scripted_button = japan_hoshuha_button
	
	scripted_button = repeal_ikokusen_uchiharairei_button
	scripted_button = reenact_ikokusen_uchiharairei_button

	scripted_button = bakufu_seisaku_new_currency_start_button
	scripted_button = bakufu_seisaku_junochisui_start_button
	scripted_button = bakufu_seisaku_agechirei_start_button
	scripted_button = bakufu_seisaku_kokishukusei_start_button


	#scripted_button = japan_bakufu_kaikaku_button
	#scripted_button = japan_hitotsubashiha_phase_1_button
	#scripted_button = japan_hitotsubashiha_phase_2_button
	#scripted_button = japan_hitotsubashiha_phase_3_button
	
	status_desc = {
		
	}

	progress_desc = {
		first_valid = {
			
		}
	}

	immediate = {
		# hitotsubashiha_influence_var와 nankiha_influence_var는 history에서 설정
		weekly_pulse_bakufu_kaikaku_progress_bar_faction = yes
	}

	

	complete = { 
		custom_tooltip = {
			text = bakufu_kaikaku_kaikoku_clear
			has_variable = bakufu_kaikaku_kaikoku_complete_var
		}
		custom_tooltip = {
			text = bakufu_kaikaku_zaisei_clear
			has_variable = bakufu_kaikaku_zaisei_complete_var
		}
		custom_tooltip = {
			text = bakufu_kaikaku_guntai_clear
			has_variable = bakufu_kaikaku_guntai_complete_var
		}
		custom_tooltip = {
			text = bakufu_kaikaku_naibu_clear
			has_variable = bakufu_kaikaku_naibu_complete_var
		}
	}

	on_complete = { 
		remove_variable = hitotsubashiha_influence_var_monthly_add
		remove_variable = nankiha_influence_var_monthly_add
		set_variable = bakufu_kaikaku_complete_var
	}

	on_monthly_pulse = {
		effect = {
			change_variable = { name = hitotsubashiha_influence_var add = var:hitotsubashiha_influence_var_monthly_add } 
			change_variable = { name = nankiha_influence_var add = var:nankiha_influence_var_monthly_add } 
			bakufu_kaikaku_progress_bar_monthly_calc = yes
			bakufu_kaikaku_progress_bar_calc = yes

			# 히토츠바시 vs 난키 대립 이벤트
			random_list = {
				2000 = {  }
				100 = {
					modifier = {
						if = { # 장군계각문제 시작 안하면 깎음
							limit = { NOT = { has_variable = hitotsubashiha_vs_nankiha_start } }
							add = -100
						}
						if = { # 고립주의 아님
							limit = { NOT = { has_law = law_type:law_isolationism } }
							add = 200
						}
						if = { # 막번체제 저널 진행도
							limit = { je:je_bakuhantaisei = { "scripted_bar_progress(bakuhantaisei_bakufu_authority_progress_bar)" <= 2000 }  }
							add = 100
						}
						if = { # 막번체제 저널 진행도
							limit = { je:je_bakuhantaisei = { "scripted_bar_progress(bakuhantaisei_bakufu_authority_progress_bar)" <= 1000 } }
							add = 100
						}
						if = { # 히토츠바시파의 approval
							limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)" <= 50 } }
							add = 100
						}
						if = { # 히토츠바시파의 approval
							limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)" <= 25 } }
							add = 200
						}
						if = { # 난키파의 approval
							limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)" <= 50 } }
							add = 100
						}
						if = { # 난키파의 approval
							limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)" <= 25 } }
							add = 200
						}
					}
					random_list = {
						100 = {
							modifier = {
								if = { # 히토츠바시파의 approval
									limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)" >= 80 } }
									add = -25
								}
								if = { # 히토츠바시파의 approval
									limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)" >= 60 } }
									add = -25
								}
								if = { # 히토츠바시파의 approval
									limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)" >= 40 } }
									add = -25
								}
								if = { # 히토츠바시파의 approval
									limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)" >= 20 } }
									add = -25
								}
							}
							random_list = {
								100 = { # 난키파 정치인 암살
									trigger = {
										je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)" <= 40 }
									}
									trigger_event = {
										id = eafp_japan.2182
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 히토츠바시파의 이국선타불령 부활 요구
									trigger = {
										has_law = law_type:law_isolationism
										NOT = { has_modifier = ikokusen_uchiharairei_modifier }
										NOT = { has_variable = eafpjap2301_cooldown }
									}
									trigger_event = {
										id = eafp_japan.2301
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 난키파 정치인 사임 요구
									trigger = { NOT = { has_journal_entry = je_eafpjap2311 } }
									trigger_event = {
										id = eafp_japan.2311
										days = { 1 30 }
										popup = yes
									}
								}
							}
						}
						100 = {
							modifier = { # 히토츠바시파의 이국선타불령 부활 요구
								if = { # 난키파의 approval
									limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)" >= 80 } }
									add = -25
								}
								if = { # 난키파의 approval
									limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)" >= 60 } }
									add = -25
								}
								if = { # 난키파의 approval
									limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)" >= 40 } }
									add = -25
								}
								if = { # 난키파의 approval
									limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)" >= 20 } }
									add = -25
								}
							}
							random_list = {
								100 = { # 히토츠바시파 정치인 암살
									trigger = {
										je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)" <= 40 }
									}
									trigger_event = {
										id = eafp_japan.2181
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 난키파의 이국선타불령 폐지 요구
									trigger = {
										has_law = law_type:law_isolationism
										has_modifier = ikokusen_uchiharairei_modifier
										NOT = { has_variable = eafpjap2306_cooldown }
									}
									trigger_event = {
										id = eafp_japan.2306
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 히토츠바시파 정치인 사임 요구
									trigger = { NOT = { has_journal_entry = je_eafpjap2310 } }
									trigger_event = {
										id = eafp_japan.2310
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 난키파의 막부 개혁 시행 요구 - 새 화폐 도입
									trigger = {
										NOT = { has_variable = je_bakufu_seisaku_new_currency_start }
										NOT = { has_variable = eafpjap2302_cooldown }
									}
									trigger_event = {
										id = eafp_japan.2302
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 난키파의 막부 개혁 시행 요구 - 중농치수
									trigger = {
										NOT = { has_variable = je_bakufu_seisaku_new_currency_start }
										NOT = { has_variable = eafpjap2302_cooldown }
									}
									trigger_event = {
										id = eafp_japan.2303
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 난키파의 막부 개혁 시행 요구 - 상지령
									trigger = {
										NOT = { has_variable = je_bakufu_seisaku_new_currency_start }
										NOT = { has_variable = eafpjap2302_cooldown }
									}
									trigger_event = {
										id = eafp_japan.2304
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 난키파의 막부 개혁 시행 요구 - 강기숙정
									trigger = {
										NOT = { has_variable = je_bakufu_seisaku_new_currency_start }
										NOT = { has_variable = eafpjap2302_cooldown }
									}
									trigger_event = {
										id = eafp_japan.2305
										days = { 1 30 }
										popup = yes
									}
								}
							}
						}
					}
				}
			}
		}

		random_events = {
			190 = 0
			10 = eafp_japan.4005
			20 = eafp_japan.4008
			20 = eafp_japan.4009
		}
	}

	on_weekly_pulse = {
		effect = {
			weekly_pulse_bakufu_kaikaku_progress_bar_faction = yes
		}
	}

	weight = 12000

	should_be_pinned_by_default = yes
}

je_bakufu_kaikoku = {
	icon = "gfx/interface/icons/goods_icons/man_o_wars.dds"

	group = je_group_historical_content

	complete = { 
		NOT = { has_law = law_type:law_isolationism }
		NOT = { has_law = law_type:law_traditionalism }
		NOT = { has_law = law_type:law_closed_borders }
	}

	on_complete = { 
		custom_tooltip = {
			text = complete_kaikaku
			set_variable = bakufu_kaikaku_kaikoku_complete_var
		}
		remove_modifier = bakufu_corruption_dip
		add_modifier = {
			name = modifier_bakufu_kaikoku_complete
			months = 60
		}
	}

	weight = 10000
}

je_bakufu_guntai = {
	icon = "gfx/interface/icons/war_goals/conquer_state.dds"

	group = je_group_historical_content

	complete = { 
		army_size >= 100
		navy_size >= 10
		has_technology_researched = napoleonic_warfare
		NOR = {
			any_scope_building = {
				is_building_type = building_barracks				
				OR = {
					building_has_goods_shortage = yes
					has_active_production_method = pm_no_organization
				}
			}
			any_military_formation = {
				filter = {
					is_army = yes
				}
				any_combat_unit = {
					has_unit_type = unit_type:combat_unit_type_irregular_infantry
				}
				percent >= 0.25
			}
		}
		any_scope_building = { 
			is_building_type = building_arms_industry
			OR = {
				has_active_production_method = pm_rifles
				has_active_production_method = pm_repeaters
				has_active_production_method = pm_bolt_action_rifles
			}
			level >= 5
			occupancy >= 0.75
		}
	}

	on_complete = { 
		custom_tooltip = {
			text = complete_kaikaku
			set_variable = bakufu_kaikaku_guntai_complete_var
		}
		remove_modifier = bakufu_corruption_mil
		add_modifier = {
			name = modifier_bakufu_guntai_complete
			months = 60
		}
	}

	weight = 10000

}

je_bakufu_naibu = {
	icon = "gfx/interface/icons/pops_icons/bureaucrats.dds"

	group = je_group_historical_content

	immediate = {
		set_variable = {
			name = shogunate_var
			value = 0
		}
	}

	complete = { 
		scope:journal_entry = { is_goal_complete = yes }
		ig:ig_landowners = {
			is_in_government = yes
		}
		government_legitimacy >= 80
		bureaucracy >= 0
		any_scope_building = {
			is_building_type = building_university
			occupancy > 0.9
			level >= 5
		}
		literacy_rate >= 0.25
	}

	on_complete = { 
		custom_tooltip = {
			text = complete_kaikaku
			set_variable = bakufu_kaikaku_naibu_complete_var
		}
		remove_modifier = bakufu_corruption_adm
		add_modifier = {
			name = modifier_bakufu_naibu_complete
			months = 60
		}
	}

	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					ig:ig_landowners = {
						is_in_government = yes
					}
					has_insurrectionary_interest_groups = no
					is_at_war = no
				}
				change_variable = {
					name = shogunate_var
					add = 1
				}
			}
		}
	}

	current_value = {
		value = root.var:shogunate_var
	}

	goal_add_value = {
		value = 120
	}

	weight = 10000

	
}

je_bakufu_zaisei = {
	icon = "gfx/interface/icons/event_icons/event_industry.dds"

	group = je_group_historical_content

	complete = { 
		scope:journal_entry = {
			is_goal_complete = yes
		}
		gold_reserves > 0
		s:STATE_KANTO.region_state:JAP = {
			is_incorporated = yes
			any_scope_building = {
				is_building_type = building_urban_center
				level >= 8
			}
		}
	}

	on_complete = { 
		custom_tooltip = {
			text = complete_kaikaku
			set_variable = bakufu_kaikaku_zaisei_complete_var
		}
		remove_modifier = bakufu_corruption_fin
		add_modifier = {
			name = modifier_bakufu_zaisei_complete
			months = 60
		}
	}

	current_value = {
		value = root.gdp
	}

	goal_add_value = {
		value = root.gdp
		multiply = 0.5
	}

	progressbar = yes
	weight = 10000

}

# 파벌 탄원

je_eafpjap2310 = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	group = je_group_internal_affairs

	complete = { 
		OR = {
			NOT = { exists = scope:target }
			NOT = { has_variable = eafp_bakuhantaisei_politician_influence }
		}
	}

	on_complete = { 
		add_nankiha_approval = {
			VALUE = 10
		}
	}

	invalid = {
		OR = {
			NOT = { has_journal_entry = je_bakufu_kaikaku }
			NOT = { has_journal_entry = je_bakuhantaisei }
		}
	}

	on_timeout = {
		add_nankiha_approval = {
			VALUE = -10
		}
	}

	timeout = 365

	weight = 1000

	should_be_pinned_by_default = yes

}

je_eafpjap2311 = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	group = je_group_internal_affairs

	complete = { 
		OR = {
			NOT = { exists = scope:target }
			NOT = { has_variable = eafp_bakuhantaisei_politician_influence }
		}
	}

	on_complete = { 
		add_hitotsubashiha_approval = {
			VALUE = 10
		}
	}

	invalid = {
		OR = {
			NOT = { has_journal_entry = je_bakufu_kaikaku }
			NOT = { has_journal_entry = je_bakuhantaisei }
		}
	}

	on_timeout = {
		add_hitotsubashiha_approval = {
			VALUE = -10
		}
	}

	timeout = 365

	weight = 1000

	should_be_pinned_by_default = yes

}

# 보신전쟁

je_boshin_war_sabaku = {
	icon = "gfx/interface/icons/ig_icons/armed_forces.dds"

	group = je_group_historical_content

	complete = {
		owns_entire_state_region = STATE_KYUSHU
		owns_entire_state_region = STATE_KANSAI
		owns_entire_state_region = STATE_CHUGOKU
		owns_entire_state_region = STATE_SHIKOKU
		owns_entire_state_region = STATE_CHUBU
		owns_entire_state_region = STATE_KANTO
		NOT = { exists = c:NIP }
	}

	weight = 20000

	should_be_pinned_by_default = yes
}

je_boshin_war_tobaku = {
	icon = "gfx/interface/icons/ig_icons/armed_forces.dds"

	group = je_group_historical_content

	complete = {
		owns_entire_state_region = STATE_KYUSHU
		owns_entire_state_region = STATE_KANSAI
		owns_entire_state_region = STATE_CHUGOKU
		owns_entire_state_region = STATE_SHIKOKU
		owns_entire_state_region = STATE_CHUBU
		owns_entire_state_region = STATE_KANTO
		NOT = { exists = c:JAP }
	}

	on_complete = {
		#trigger_event = {
		#	id = new_meiji.1
		#}
	}

	weight = 20000

	should_be_pinned_by_default = yes
}