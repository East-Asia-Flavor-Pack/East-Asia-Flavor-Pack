je_warlord_china = {
	icon = "gfx/interface/icons/event_icons/event_fire.dds"

	immediate = {
		set_variable = {
			name = china_warlord_explosion
			value = 0
		}
		set_variable = {
			name = china_warlord_explosion_percent
			value = 0
		}
		set_variable = {
			name = china_warlord_explosion_percent_radical
			value = {
				value = radical_fraction
				multiply = 100
			}
		}
		set_variable = {
			name = china_warlord_explosion_percent_loyalist
			value = {
				value = loyalist_fraction
				multiply = 100
			}
		}

		set_variable = {
			name = china_warlord_explosion_sum
			value = var:china_warlord_explosion_percent_radical
		}
		change_variable = {
			name = china_warlord_explosion_sum
			subtract = var:china_warlord_explosion_percent_loyalist
		}
		random_law = {
			limit = { type = law_type:law_monarchy }
			save_scope_as = monarchy_scope
		}
	}

	complete = {
		scope:journal_entry = {
			is_goal_complete = yes
		}
		custom_tooltip = {
			text = warlord_china_criteria
		}
	}

	fail = {
		custom_tooltip = {
			text = won_boxer_tt
			has_variable = won_boxer_rebellion
		}
		custom_tooltip = {
			text = china_recognized_tt
			has_variable = china_warlord_explosion_recognized
		}
		custom_tooltip = {
			text = china_abolished_monarchy_tt
			has_variable = china_warlord_abolished_monarchy
		}
	}

	on_complete = {
		hidden_effect = { # 추가
			remove_variable = china_warlord_explosion
			remove_variable = china_warlord_explosion_percent
			remove_variable = china_warlord_explosion_percent_radical
			remove_variable = china_warlord_explosion_percent_loyalist
			remove_variable = china_warlord_explosion_sum
		}
		trigger_event = { id = warlord_china_events.100 }
	}

	on_fail = { # 추가
		hidden_effect = {
			remove_variable = china_warlord_explosion
			remove_variable = china_warlord_explosion_percent
			remove_variable = china_warlord_explosion_percent_radical
			remove_variable = china_warlord_explosion_percent_loyalist
			remove_variable = china_warlord_explosion_sum
		}
	}

	current_value = {
		value = var:china_warlord_explosion_sum
	}

	goal_add_value = {
		add = 100
	}
	
	progressbar = yes

	on_weekly_pulse = {
		effect = {
			if = {
				limit = {
					NOT = { has_variable = china_warlord_explosion_subject }
					is_subject = yes
				}
				post_notification = warlord_china_explosion_point_add
				change_variable = {
					name = china_warlord_explosion
					add = 1
				}
				set_variable = china_warlord_explosion_subject
			}
			# if = { 제거
			# 	limit = {
			# 		NOT = { has_variable = china_warlord_explosion_recognized }
			# 		country_rank != rank_value:unrecognized_power
			# 		country_rank != rank_value:unrecognized_major_power
			# 		country_rank != rank_value:unrecognized_regional_power
			# 	}
			# 	set_variable = china_warlord_explosion_recognized
			# 	post_notification = warlord_china_explosion_point_remove
			# 	change_variable = {
			# 		name = china_warlord_explosion
			# 		subtract = 1
			# 	}
			# }
			if = {
				limit = {
					NOT = { has_variable = china_abolished_monarchy }
					NOT = { has_law = law_type:law_monarchy }
				}
				set_variable = china_abolished_monarchy
				post_notification = warlord_china_explosion_point_add
				change_variable = {
					name = china_warlord_explosion
					add = 1
				}
				if = {
					limit = {
						NOT = { has_variable = china_han_empire }
					}
					trigger_event = { id = boxer_rebellion_events.4 days = 0 popup = yes }
				}
			}
			random_list = {
				1 = {
					if = {
						limit = {
							NOT = { has_journal_entry = je_heavenly_kingdom_main }
							NOT = { exists = c:TPG }
							NOT = { has_variable = taiping_happened }
							year >= 1846
							year <= 1860
						}
						trigger_event = {
							id = heavenly.1
							days = 3
						}	
					}
				}
				19 = { }
			}
			if = {
				limit = {
					any_state_region = {
						OR = {
							is_homeland = cu:han
							is_homeland = cu:manchu
						}
						OR = {
							region = sr:region_south_china
							region = sr:region_north_china
							region = sr:region_manchuria
						}
						any_scope_state = {
							NOT = {
								owner = {
									OR = {
										this = ROOT
										top_overlord = ROOT
									}
								}
							}
							is_treaty_port = no
						}
					}
				}
				trigger_event = { id = chinese_westernization.1 }
			}
			set_variable = {
				name = china_warlord_explosion_percent
				value = {
					value = var:china_warlord_explosion
					multiply = 20
				}
			}
			set_variable = {
				name = china_warlord_explosion_percent_radical
				value = {
					value = radical_fraction
					multiply = 100
				}
			}
			set_variable = {
				name = china_warlord_explosion_percent_loyalist
				value = {
					value = loyalist_fraction
					multiply = 100
				}
			}
	
			set_variable = {
				name = china_warlord_explosion_sum
				value = var:china_warlord_explosion_percent
			}
			change_variable = {
				name = china_warlord_explosion_sum
				add = var:china_warlord_explosion_percent_radical
			}
			change_variable = {
				name = china_warlord_explosion_sum
				subtract = var:china_warlord_explosion_percent_loyalist
			}
		}
	}

	weight = 10000
	should_be_pinned_by_default = yes
}

je_xinhai_revolution = { # TODO
	icon = "gfx/interface/icons/event_icons/event_military.dds"

	immediate = {
		set_variable = {
			name = china_warlord_explosion_cycle
			value = 0
		}
		trigger_event = { id = warlord_china_events.1 } # (도시 이름) 봉기
	}

	complete = {
		scope:journal_entry = { is_goal_complete = yes }
	}


	on_complete = {
		
	}

	current_value = {
		value = var:china_warlord_explosion_cycle
	}

	goal_add_value = {
		add = 20
	}
	
	progressbar = yes

	on_weekly_pulse = {
		effect = {
			change_variable = {
				name = china_warlord_explosion_cycle
				add = 1
			}
			if = {
				limit = { var:china_warlord_explosion_cycle = 2 }
				trigger_event = { id = warlord_china_events.2 } # 다른 지역의 동조 TODO
			}
			if = {
				limit = { var:china_warlord_explosion_cycle = 4 }
				trigger_event = { id = warlord_china_events.3 } # 군벌 독립 TODO
			}
		}
	}

	weight = 10000
	should_be_pinned_by_default = yes
}