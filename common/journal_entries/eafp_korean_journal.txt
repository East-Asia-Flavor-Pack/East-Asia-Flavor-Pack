##왕의 건강
je_korean_kings_health = {
	icon = "gfx/interface/icons/eafp_icons/medicine.dds"

	group = je_group_historical_content
	
	scripted_progress_bar = eafp_progress_bar_kings_health
	
	scripted_button = eafp_scripted_button_health_walk
	scripted_button = eafp_scripted_button_health_inspectation_tour
	scripted_button = eafp_scripted_button_health_hunting
	scripted_button = eafp_scripted_button_health_tomb_tour

	complete = {
		has_technology_researched = quinine
	}

	on_complete = {
		ruler = {
			hidden_effect = {
				set_character_busy_and_immortal = no
			}
		}
		every_interest_group = {
			leader = {
				hidden_effect = {
					set_character_busy_and_immortal = no
				}
			}
		}
		remove_variable = no_heirs
		trigger_event = eafp_kor_mainline.19
	}
	
	fail = {	#급사
		custom_tooltip = {
			text = je_korean_kings_health_goal
			always = no
		}
	}

	on_fail = {
		
	}

	status_desc = {
		first_valid = {
			triggered_desc = {
				desc = je_korean_kings_health_death
				trigger = {
					je:je_korean_kings_health ?= {
						"scripted_bar_progress(eafp_progress_bar_kings_health)" >= 450
					}
				}
			}
			triggered_desc = {
				desc = je_korean_kings_health_verylow
				trigger = {
					je:je_korean_kings_health ?= {
						"scripted_bar_progress(eafp_progress_bar_kings_health)" >= 400
					}
				}
			}
			triggered_desc = {
				desc = je_korean_kings_health_low
				trigger = {
					je:je_korean_kings_health ?= {
						"scripted_bar_progress(eafp_progress_bar_kings_health)" >= 300
					}
				}
			}
			triggered_desc = {
				desc = je_korean_kings_health_medium
				trigger = {
					je:je_korean_kings_health ?= {
						"scripted_bar_progress(eafp_progress_bar_kings_health)" >= 200
					}
				}
			}
			triggered_desc = {
				desc = je_korean_kings_health_high
				trigger = {
					je:je_korean_kings_health ?= {
						"scripted_bar_progress(eafp_progress_bar_kings_health)" >= 100
					}
				}
			}
			triggered_desc = {
				desc = je_korean_kings_health_veryhigh
				trigger = {
					always = yes
				}
			}
		}
	}

	on_monthly_pulse = {
		effect = {
			##역사적 이벤트
			# 헌종
			if = {
				limit = {
					ruler = {
						OR = {
							has_trait = kor_hwan_slot_1
							has_trait = kor_hwan_slot_2
							has_trait = kor_hwan_slot_3
							has_trait = kor_hwan_slot_4
							has_trait = kor_hwan_slot_5
							has_trait = kor_hwan_slot_6
						}
					}
				}
				random_list = {
					30 = {}
					50 = {
						trigger = {
							ruler = {
								calc_true_if = {
									amount <= 5
									has_trait = kor_hwan_slot_1
									has_trait = kor_hwan_slot_2
									has_trait = kor_hwan_slot_3
									has_trait = kor_hwan_slot_4
									has_trait = kor_hwan_slot_5
									has_trait = kor_hwan_slot_6
								}
							}
						}
					}
					70 = {
						trigger = {
							ruler = {
								calc_true_if = {
									amount <= 4
									has_trait = kor_hwan_slot_1
									has_trait = kor_hwan_slot_2
									has_trait = kor_hwan_slot_3
									has_trait = kor_hwan_slot_4
									has_trait = kor_hwan_slot_5
									has_trait = kor_hwan_slot_6
								}
							}
						}
					}
					90 = {
						trigger = {
							ruler = {
								calc_true_if = {
									amount <= 3
									has_trait = kor_hwan_slot_1
									has_trait = kor_hwan_slot_2
									has_trait = kor_hwan_slot_3
									has_trait = kor_hwan_slot_4
									has_trait = kor_hwan_slot_5
									has_trait = kor_hwan_slot_6
								}
							}
						}
					}
					110 = {
						trigger = {
							ruler = {
								calc_true_if = {
									amount <= 2
									has_trait = kor_hwan_slot_1
									has_trait = kor_hwan_slot_2
									has_trait = kor_hwan_slot_3
									has_trait = kor_hwan_slot_4
									has_trait = kor_hwan_slot_5
									has_trait = kor_hwan_slot_6
								}
							}
						}
					}
					130 = {
						trigger = {
							ruler = {
								calc_true_if = {
									amount <= 1
									has_trait = kor_hwan_slot_1
									has_trait = kor_hwan_slot_2
									has_trait = kor_hwan_slot_3
									has_trait = kor_hwan_slot_4
									has_trait = kor_hwan_slot_5
									has_trait = kor_hwan_slot_6
								}
							}
						}
					}
					1 = { trigger_event = { id = eafp_kor_mainline.20 } }
					1 = { trigger_event = { id = eafp_kor_mainline.21 } }
					1 = { trigger_event = { id = eafp_kor_mainline.22 } }
					1 = { trigger_event = { id = eafp_kor_mainline.23 } }
					1 = { trigger_event = { id = eafp_kor_mainline.24 } }
					1 = { trigger_event = { id = eafp_kor_mainline.25 } }
					1 = { trigger_event = { id = eafp_kor_mainline.26 } }
					# 1 = { trigger_event = { id = eafp_kor_mainline.27 } }
					1 = { trigger_event = { id = eafp_kor_mainline.28 } }
					# 1 = { trigger_event = { id = eafp_kor_mainline.29 } }
					1 = { trigger_event = { id = eafp_kor_mainline.30 } }
				}
			}
		}
		events = {
			eafp_kor_mainline.6
			eafp_kor_mainline.7
			eafp_kor_mainline.8
			eafp_kor_mainline.9
		}
	}

	on_weekly_pulse = {
		effect = {
			if = {
				limit = {
					scope:journal_entry ?= {
						"scripted_bar_progress(eafp_progress_bar_kings_health)" >= 500
					}
				}
				scope:journal_entry = {
					set_bar_progress = { value = 0 name = eafp_progress_bar_kings_health }
				}
				ruler = {
					hidden_effect = {
						set_character_busy_and_immortal = no
					}
					kill_character = yes
				}
			}
		}
	}

	weight = 3000
	
	should_be_pinned_by_default = yes
}

##삼정개혁
je_korean_land_problem = {
	icon = "gfx/interface/icons/goods_icons/grain.dds"

	group = je_group_historical_content

	immediate = {
		eafp_land_problem_add_modifier = yes	#초기 모디파이어 설정
	}

	scripted_progress_bar = eafp_progress_bar_land_problem_landexp_adm
	scripted_progress_bar = eafp_progress_bar_land_problem_landexp_mil
	scripted_progress_bar = eafp_progress_bar_land_problem_landexp_civ

	complete = {
		custom_tooltip = {
			text = je_korean_land_problem_complete_cond_tt
			has_variable = eafp_var_sam_all_clear
		}
	}

	on_complete = {
		trigger_event = { id = eafp_kor_mainline.299 }
	}
	
	scripted_button = eafp_scripted_button_sam_jeon
	scripted_button = eafp_scripted_button_sam_gun
	scripted_button = eafp_scripted_button_sam_hwan
	scripted_button = eafp_scripted_button_sam_all

	on_monthly_pulse = {
		effect = {
			#모디파이어 업데이트
			eafp_land_problem_add_modifier = yes
			if = {
				limit = {
					NOT = { has_variable = eafp_var_sam_gun_clear }
					}
				remove_modifier = eafp_modi_land_problem_mil_country
				add_modifier = {
					name = eafp_modi_land_problem_mil_country
					multiplier = eafp_val_total_mil_modi_mult
				}			
			}
		}
		events = {
			eafp_kor_mainline.200
		}
	}

	#progressbar = yes

	weight = 2000
	
	should_be_pinned_by_default = yes

	can_revolution_inherit = yes
}
##양전
je_yangjeon = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	group = je_group_historical_content

	scripted_progress_bar = eafp_progress_bar_yangjeon

	scripted_button = eafp_scripted_button_yangjeon
	scripted_button = eafp_scripted_button_yangjeon2

	immediate = {
		set_variable = {
			name = eafp_var_yangjeon_weekly
			value = 1
		}
		add_modifier = {
			name = eafp_modi_yangjeon_cost
			multiplier = 3000
		}
	}

	complete = {
		custom_tooltip = {
			text = je_korean_imsul_uprising_goal
			scope:journal_entry = {
				"scripted_bar_progress(eafp_progress_bar_yangjeon)" >= 360
			}
		}
	}

	on_complete = {
		set_variable = eafp_var_sam_jeon_clear
		remove_variable = eafp_var_yangjeon_weekly
		remove_modifier = eafp_modi_yangjeon_cost
		
		trigger_event = { id = eafp_kor_mainline.298 }
	}

	weight = 2000
	
	should_be_pinned_by_default = yes

	can_revolution_inherit = yes
}
##임술농민봉기
je_korean_imsul_uprising = {
	icon = "gfx/interface/icons/pops_icons/peasants.dds"

	group = je_group_historical_content

	is_shown_when_inactive = {
		c:KOR ?= THIS
		NOT = { has_variable = eafp_var_sam_all_clear }
	}

	possible = {
		radical_fraction = {
			value >= 0.25
		}
	}

	immediate = {
		set_variable = {
			name = eafp_var_je_imsul_uprising
			value = 0
		}
		##대상 주 선정
		ordered_scope_state = {
			limit = {
				OR = {
					state_region = s:STATE_SEOUL
					state_region = s:STATE_YANGHO
					state_region = s:STATE_BUSAN
					state_region = s:STATE_PYONGYANG
					state_region = s:STATE_SARIWON
				}
			}
			order_by = radical_fraction
			position = 0
			save_scope_as = eafp_imsul_rising_target_state
		}
		ordered_scope_state = {
			limit = {
				OR = {
					state_region = s:STATE_SEOUL
					state_region = s:STATE_YANGHO
					state_region = s:STATE_BUSAN
					state_region = s:STATE_PYONGYANG
					state_region = s:STATE_SARIWON
				}
			}
			order_by = radical_fraction
			position = 1
			save_scope_as = eafp_imsul_rising_target_state_2nd
		}
		ordered_scope_state = {
			limit = {
				OR = {
					state_region = s:STATE_SEOUL
					state_region = s:STATE_YANGHO
					state_region = s:STATE_BUSAN
					state_region = s:STATE_PYONGYANG
					state_region = s:STATE_SARIWON
				}
			}
			order_by = radical_fraction
			position = 2
			save_scope_as = eafp_imsul_rising_target_state_3rd
		}
	}

	complete = {	#중기적 개혁
		OR = {
			radical_fraction = {
				value <= 0.1
			}
			custom_tooltip = {
				text = je_korean_land_problem_complete_cond_tt
				has_variable = eafp_var_sam_all_clear
			}
		}
	}

	on_complete = {
		trigger_event = { id = eafp_kor_mainline.220 }
	}
	
	fail = {
		scope:journal_entry = {
			is_goal_complete = yes
		}
	}

	on_fail = { # 추가
		if = {
			limit = { has_journal_entry = je_korean_imsul_uprising }
			custom_tooltip = {
				text = je_korean_imsul_uprising_fail_tt
			}
			scope:eafp_imsul_rising_target_state = {
				add_modifier = {
					name = eafp_modi_imsul_state_zero
					months = 24
				}
			}
		}
		hidden_effect = {
			add_journal_entry = { type = je_korean_imsul_boom }	#봉기 점화
		}
	}
	
	modifiers_while_active = {
		#fra_republican_unrest
	}
	
	progress_desc = {
		first_valid = {
			triggered_desc = {
				trigger = {
					has_journal_entry = je_korean_imsul_uprising
				}
				desc = je_korean_imsul_uprising_pgdesc
			}
			desc = EMPTY_STRING
		}
	}
	
	on_weekly_pulse = {
		effect = {
			#대상 주 갱신
			#clear_saved_scope = eafp_imsul_rising_target_state
			ordered_scope_state = {
				limit = {
					OR = {
						state_region = s:STATE_SEOUL
						state_region = s:STATE_YANGHO
						state_region = s:STATE_BUSAN
						state_region = s:STATE_PYONGYANG
						state_region = s:STATE_SARIWON
					}
				}
				order_by = radical_fraction
				save_scope_as = eafp_imsul_rising_target_state
			}
			ordered_scope_state = {
				limit = {
					OR = {
						state_region = s:STATE_SEOUL
						state_region = s:STATE_YANGHO
						state_region = s:STATE_BUSAN
						state_region = s:STATE_PYONGYANG
						state_region = s:STATE_SARIWON
					}
				}
				order_by = radical_fraction
				position = 1
				save_scope_as = eafp_imsul_rising_target_state_2nd
			}
			ordered_scope_state = {
				limit = {
					OR = {
						state_region = s:STATE_SEOUL
						state_region = s:STATE_YANGHO
						state_region = s:STATE_BUSAN
						state_region = s:STATE_PYONGYANG
						state_region = s:STATE_SARIWON
					}
				}
				order_by = radical_fraction
				position = 2
				save_scope_as = eafp_imsul_rising_target_state_3rd
			}
		}
	}

	on_monthly_pulse = {
		effect = {
			#전국 합산 개선진행도 체크
			change_variable = {
				name = eafp_var_je_imsul_uprising
				add = 1
			}
		}
		events = {
			eafp_kor_mainline.206
			eafp_kor_mainline.207
			eafp_kor_mainline.208
			eafp_kor_mainline.209
			eafp_kor_mainline.210
		}
	}

	current_value = {
		value = root.var:eafp_var_je_imsul_uprising
	}

	goal_add_value = {
		value = 36
	}

	progressbar = yes

	weight = 1999
	
	should_be_pinned_by_default = yes
}
##농민봉기발발
je_korean_imsul_boom = {
	icon = "gfx/interface/icons/pops_icons/peasants.dds"

	group = je_group_historical_content

	scripted_progress_bar = eafp_progress_bar_imsul_relax
	scripted_progress_bar = eafp_progress_bar_imsul_spread
	
	scripted_button = eafp_scripted_button_imsul_1
	scripted_button = eafp_scripted_button_imsul_2
	scripted_button = eafp_scripted_button_imsul_3
	scripted_button = eafp_scripted_button_imsul_4
	scripted_button = eafp_scripted_button_imsul_5
	scripted_button = eafp_scripted_button_imsul_6
	scripted_button = eafp_scripted_button_imsul_lockdown
	scripted_button = eafp_scripted_button_imsul_reopening
	scripted_button = eafp_scripted_button_imsul_final
	
	modifiers_while_active = {
		eafp_modi_imsul_boom_unrest
	}
	
	immediate = {
		##대상 주 선정
		ordered_scope_state = {
			limit = {
				OR = {
					state_region = s:STATE_SEOUL
					state_region = s:STATE_YANGHO
					state_region = s:STATE_BUSAN
					state_region = s:STATE_PYONGYANG
					state_region = s:STATE_SARIWON
				}
			}
			order_by = radical_fraction
			position = 0
			save_scope_as = eafp_imsul_rising_target_state
		}
		ordered_scope_state = {
			limit = {
				OR = {
					state_region = s:STATE_SEOUL
					state_region = s:STATE_YANGHO
					state_region = s:STATE_BUSAN
					state_region = s:STATE_PYONGYANG
					state_region = s:STATE_SARIWON
				}
			}
			order_by = radical_fraction
			position = 1
			save_scope_as = eafp_imsul_rising_target_state_2nd
		}
		ordered_scope_state = {
			limit = {
				OR = {
					state_region = s:STATE_SEOUL
					state_region = s:STATE_YANGHO
					state_region = s:STATE_BUSAN
					state_region = s:STATE_PYONGYANG
					state_region = s:STATE_SARIWON
				}
			}
			order_by = radical_fraction
			position = 2
			save_scope_as = eafp_imsul_rising_target_state_3rd
		}
		set_variable = { # 로컬용
			name = eafp_imsul_rising_target_state
			value = scope:eafp_imsul_rising_target_state
		}
		scope:eafp_imsul_rising_target_state = {
			set_variable = {	#확산여부. 값 1은 해당 주의 중심고을만, 해당 지역 인근고을 전파시마다 +1, 최대 3
				name = eafp_var_imsul_on_state
				value = 1
			}
			trigger_event = { id = eafp_kor_mainline.211 }
		}
	}

	complete = {	#중기적 개혁
		#always = no
		custom_tooltip = {
			text = je_korean_imsul_boom_complete_cond_tt
			has_global_variable = eafp_global_var_imsul_finish
		}
	}

	on_complete = {
		every_scope_state = {
			remove_modifier = eafp_modi_imsul_state_zero
			remove_modifier = eafp_modi_imsul_state_lockdown
		}
		remove_variable = eafp_imsul_rising_target_state
	}
	
	fail = {
		always = no
	}

	on_fail = {
		custom_tooltip = {
			text = je_korean_imsul_boom_fail_tt
		}
		remove_variable = eafp_imsul_rising_target_state
	}
	
	#progress_desc = {
	#	first_valid = {
	#		desc = je_korean_imsul_uprising_pgdesc
	#	}
	#}
	
	on_weekly_pulse = {
		effect = {
			#진행바
			if = {
				limit = {
					scope:journal_entry = {
						"scripted_bar_progress(eafp_progress_bar_imsul_spread)" >= 100
					}
				}
				scope:journal_entry = {
					add_progress = { value = -100 name = eafp_progress_bar_imsul_spread }
				}
				random_list = {
					#inner 주 내부 확산
					5 = {
						trigger = {
							any_scope_state = {
								has_variable = eafp_var_imsul_on_state	#이미 봉기가 확산되어 있고,
								var:eafp_var_imsul_on_state < 3	#봉기 고을 슬롯이 남아있다면.
							}
						}
						random_scope_state = {
							limit = {
								has_variable = eafp_var_imsul_on_state	#이미 봉기가 확산되어 있고,
								var:eafp_var_imsul_on_state < 3	#봉기 고을 슬롯이 남아있다면.
							}
							trigger_event = {
								id = eafp_kor_mainline.217
							}
						}
					}
					#outer 주 외부 확장
					1 = {
						trigger = {
							#조건 2. 기본값
							any_scope_state = {
								NOT = { has_variable = eafp_var_imsul_on_state }	#아직 봉기가 퍼지지 아니하였으며,
								OR = {	#한반도 5개 주 중 하나라면.
									state_region = s:STATE_SEOUL
									state_region = s:STATE_YANGHO
									state_region = s:STATE_BUSAN
									state_region = s:STATE_PYONGYANG
									state_region = s:STATE_SARIWON
								}
							}
						}
						random_scope_state = {
							limit = {
								NOT = { has_variable = eafp_var_imsul_on_state }	#아직 봉기가 퍼지지 아니하였으며,
								OR = {	#한반도 5개 주 중 하나라면.
									state_region = s:STATE_SEOUL
									state_region = s:STATE_YANGHO
									state_region = s:STATE_BUSAN
									state_region = s:STATE_PYONGYANG
									state_region = s:STATE_SARIWON
								}
							}
							trigger_event = {
								id = eafp_kor_mainline.218
							}
						}
					}
					3 = {
						trigger = {
							#조건 2-1. 삼남지방 확률 보정
							any_scope_state = {
								NOT = { has_variable = eafp_var_imsul_on_state }	#아직 봉기가 퍼지지 아니하였으며,
								OR = {	#삼남지방이라면.
									state_region = s:STATE_YANGHO
									state_region = s:STATE_BUSAN
								}
							}
						}
						random_scope_state = {
							limit = {
								NOT = { has_variable = eafp_var_imsul_on_state }	#아직 봉기가 퍼지지 아니하였으며,
								OR = {	#삼남지방이라면.
									state_region = s:STATE_YANGHO
									state_region = s:STATE_BUSAN
								}
							}
							trigger_event = {
								id = eafp_kor_mainline.218
							}
						}
					}
					1 = {
						trigger = {
							#조건 2-2. 첫 도간 확산 확률보정
							any_scope_state = {
								NOT = { has_variable = eafp_var_imsul_on_state }	#아직 봉기가 퍼지지 아니하였으며,
								OR = {	#한반도 5개 주 중 하나라면,
									state_region = s:STATE_SEOUL
									state_region = s:STATE_YANGHO
									state_region = s:STATE_BUSAN
									state_region = s:STATE_PYONGYANG
									state_region = s:STATE_SARIWON
								}
								owner = {
									NOT = { has_variable = eafp_var_imsul_interstate_spread }	#아직 발원지 외에 확산된 지방이 없다면?
								}
							}
						}
						random_scope_state = {
							limit = {
								NOT = { has_variable = eafp_var_imsul_on_state }	#아직 봉기가 퍼지지 아니하였으며,
								OR = {	#한반도 5개 주 중 하나라면,
									state_region = s:STATE_SEOUL
									state_region = s:STATE_YANGHO
									state_region = s:STATE_BUSAN
									state_region = s:STATE_PYONGYANG
									state_region = s:STATE_SARIWON
								}
							}
							trigger_event = {
								id = eafp_kor_mainline.218
							}
						}
					}
					3 = {
						trigger = {
							#조건 2-3. 육로 인접 여부 확률보정
							any_scope_state = {
								NOT = { has_variable = eafp_var_imsul_on_state }	#아직 봉기가 퍼지지 아니하였으며,
								OR = {	#한반도 5개 주 중 하나이고,
									state_region = s:STATE_SEOUL
									state_region = s:STATE_YANGHO
									state_region = s:STATE_BUSAN
									state_region = s:STATE_PYONGYANG
									state_region = s:STATE_SARIWON
								}
								any_neighbouring_state = {
									has_variable = eafp_var_imsul_on_state #봉기가 퍼진 주와 육로로 인접해있다면.
								}
							}
						}
						random_scope_state = {
							limit = {
								NOT = { has_variable = eafp_var_imsul_on_state }	#아직 봉기가 퍼지지 아니하였으며,
								OR = {	#한반도 5개 주 중 하나이고,
									state_region = s:STATE_SEOUL
									state_region = s:STATE_YANGHO
									state_region = s:STATE_BUSAN
									state_region = s:STATE_PYONGYANG
									state_region = s:STATE_SARIWON
								}
								any_neighbouring_state = {
									has_variable = eafp_var_imsul_on_state #봉기가 퍼진 주와 육로로 인접해있다면.
								}
							}
							trigger_event = {
								id = eafp_kor_mainline.218
							}
						}
					}
				}
			}
		}
	}

	on_monthly_pulse = {
		effect = {
			#부수피해 굴림
			if = {
				limit = {
					scope:journal_entry = {
						"scripted_bar_progress(eafp_progress_bar_imsul_relax)" >= 20
						"scripted_bar_progress(eafp_progress_bar_imsul_relax)" <= 80
					}
					scope:journal_entry = {
						"scripted_bar_progress(eafp_progress_bar_imsul_spread)" >= 50
					}
				}
				random_scope_state = {
					limit = {
						has_variable = eafp_var_imsul_on_state	#이미 봉기가 확산되어 있는 주 중에서,
					}
					trigger_event = { id = eafp_kor_mainline.219 }
				}
			}

			if = {
				limit = {
					je:je_korean_imsul_boom = {
						"scripted_bar_progress(eafp_progress_bar_imsul_relax)" >= 90
					}
				}
				trigger_event = { id = eafp_kor_mainline.220 }
			}
		}
	}
	
	weight = 1999
	
	should_be_pinned_by_default = yes
}
##삼정이정청
je_samjeong_ijeongcheong = {
	icon = "gfx/interface/icons/pops_icons/peasants.dds"

	group = je_group_historical_content

	scripted_progress_bar = eafp_progress_bar_samjeong_ijeongcheong_progressiveness
	scripted_progress_bar = eafp_progress_bar_samjeong_ijeongcheong_timer

	scripted_button = eafp_scripted_button_samjeong_ijeongcheong_add_timer
	scripted_button = eafp_scripted_button_samjeong_ijeongcheong_add_progressiveness

	immediate = {
		set_variable = {
			name = samjeong_ijeongcheong_var
			value = 0
		}
		add_modifier = {
			name = eafp_modi_samjeong_ijeongcheong
			multiplier = var:samjeong_ijeongcheong_var
		}
	}

	complete = {
		custom_tooltip = {
			text = je_samjeong_ijeongcheong_complete_tt
			scope:journal_entry = {
				"scripted_bar_progress(eafp_progress_bar_samjeong_ijeongcheong_timer)" <= 0
			}
		}
	}

	on_complete = {
		trigger_event = { id = eafp_kor_mainline.226 }
	}
	
	weight = 1000
	
	should_be_pinned_by_default = yes
}
##철종 경연
je_king_cheoljong_education = {
	icon = "gfx/interface/icons/law_icons/public_schools.dds"

	group = je_group_historical_content

	scripted_progress_bar = eafp_progress_bar_king_cheoljong_education

	scripted_button = eafp_scripted_button_royal_lecture
	scripted_button = eafp_scripted_button_royal_lecture2
	scripted_button = eafp_scripted_button_royal_lecture3
	scripted_button = eafp_scripted_button_royal_lecture4

	immediate = {
		
	}

	complete = {
		custom_tooltip = {
			text = je_king_cheoljong_education_goal
			scope:journal_entry = {
				"scripted_bar_progress(eafp_progress_bar_king_cheoljong_education)" >= 200
			}
		}
	}

	on_complete = {
		trigger_event = { id = eafp_kor_mainline.99 }
		show_as_tooltip = {
			eafp_effect_option_gain_balance = {
				BALANCE = -50
			}
			ruler = {
				add_trait = erudite
				if = {
					limit = { has_modifier = eafp_modi_puppet_king_imsi }
					remove_modifier = eafp_modi_puppet_king_imsi
				}
				if = {
					limit = { has_modifier = eafp_modi_puppet_king }
					remove_modifier = eafp_modi_puppet_king
				}
				set_ideology = ideology:ideology_land_reformer
			}
		}
		remove_variable = eafp_var_je_king_cheoljong_education_royal_lecture
		remove_modifier = eafp_modi_cheoljong_royal_lecture
	}
	
	fail = {
		ruler = {
			NOT = { has_template = eafp_kor_yi_byeon_character_template }
		}
	}

	on_fail = {
		remove_variable = eafp_var_je_king_cheoljong_education_royal_lecture
		remove_modifier = eafp_modi_cheoljong_royal_lecture
	}

	on_monthly_pulse = {
		events = {
			eafp_kor_mainline.81
			eafp_kor_mainline.82
			eafp_kor_mainline.83
			eafp_kor_mainline.84
			eafp_kor_mainline.85
			eafp_kor_mainline.86
			eafp_kor_mainline.87
			eafp_kor_mainline.88
			eafp_kor_mainline.89
			eafp_kor_mainline.90
			eafp_kor_mainline.91
			eafp_kor_mainline.92
			eafp_kor_mainline.93
			eafp_kor_mainline.94
			eafp_kor_mainline.95
			eafp_kor_mainline.96
			eafp_kor_mainline.97
			eafp_kor_mainline.98
		}
	}
	
	weight = 1000
	
	should_be_pinned_by_default = yes
}
##수렴청정
je_korean_regent = {
	icon = "gfx/interface/icons/law_icons/multicultural.dds"

	group = je_group_historical_content

	immediate = {
		if = {
			limit = { NOT = { has_variable = eafp_var_je_regent_regnal_year } }
			set_variable = {
				name = eafp_var_je_regent_regnal_year
				value = 1
			}
		}
		
		# eafp_var_je_regent_character는 인물 히스토리에서
	}
	
	invalid = {
		country_je_sedo_politics_is_invalid = yes
	}

	on_invalid = {
		var:eafp_var_je_regent_character = {
			set_character_busy_and_immortal = no
		}
		remove_variable = eafp_var_je_regent_regnal_year
		remove_variable = eafp_var_je_regent_character
		post_notification = eafp_message_end_regent
	}

	complete = {	
		custom_tooltip = {
			text = je_korean_regent_complete_tt1
			ruler.age >= define:NCharacters|ADULT_AGE
		}
		custom_tooltip = {
			text = je_korean_regent_complete_tt2
			var:eafp_var_je_regent_regnal_year >= 3
		}
	}

	on_complete = {
		hidden_effect = {
			var:eafp_var_je_regent_character = {
				set_character_busy_and_immortal = no
			}
			remove_variable = eafp_var_je_regent_regnal_year
			remove_variable = eafp_var_je_regent_character

			if = {
				limit = {
					ruler = { has_template = eafp_kor_yi_hwan_character_template }
				}
				trigger_event = { id = eafp_kor_mainline.105 }
			}
			else_if = {
				limit = {
					ruler = { has_template = eafp_kor_yi_byeon_character_template }
				}
				trigger_event = { id = eafp_kor_mainline.106 }
			}
			else_if = {
				limit = {
					ruler = { has_template = eafp_kor_yi_hyeong_character_template }
				}
				trigger_event = { id = eafp_kor_mainline.107 }
			}
			post_notification = eafp_message_end_regent
		}
	}

	on_weekly_pulse = {
		effect = {
			eafp_regent_lifespan_pulse = yes  # 대왕대비 등장&퇴장
		}
	}

	weight = 1000
	
	should_be_pinned_by_default = yes
}

##세도정치
je_sedo_politics = {
	icon = "gfx/interface/icons/law_icons/multicultural.dds"

	group = je_group_historical_content

	immediate = {
		set_variable = {
			name = eafp_var_je_sedo_politics_balance
			value = 150
		}
		set_variable = {
			name = eafp_var_je_sedo_politics_account
			value = 150000
		}
	}
	
	scripted_button = eafp_scripted_button_sedo_politics_balance_authority
	scripted_button = eafp_scripted_button_sedo_politics_balance_bureaucracy
	scripted_button = eafp_scripted_button_sedo_politics_balance_money
	scripted_button = eafp_scripted_button_sedo_politics_balance_remove

	scripted_button = eafp_scripted_button_sedo_politics_balance_authority_ai
	scripted_button = eafp_scripted_button_sedo_politics_balance_bureaucracy_ai
	scripted_button = eafp_scripted_button_sedo_politics_balance_money_ai
	
	modifiers_while_active = {
		eafp_modi_monarchy_power
	}
	
	invalid = {
		country_je_sedo_politics_is_invalid = yes
	}

	on_invalid = {
		hidden_effect = {
			ig:ig_landowners = {
				leader = {
					set_character_busy_and_immortal = no
				}
			}
			remove_variable = eafp_var_je_sedo_politics_balance
			remove_variable = eafp_var_je_sedo_politics_account
			remove_modifier = eafp_modi_sedo_they_are_angry
			remove_modifier = eafp_modi_sedo_politics_power_balance_5_country
			ig:ig_landowners.leader = {
				remove_modifier = eafp_modi_sedo_politics_power_balance_5_character
			}
		}
	}

	complete = {
		custom_tooltip = {
			text = je_sedo_politics_complete_tt
			var:eafp_var_je_sedo_politics_balance <= 0
		}
	}

	on_complete = {
		hidden_effect = {
			ig:ig_landowners = {
				leader = {
					set_character_busy_and_immortal = no
				}
			}
			remove_variable = eafp_var_je_sedo_politics_balance
			remove_variable = eafp_var_je_sedo_politics_account
			remove_modifier = eafp_modi_sedo_they_are_angry
			remove_modifier = eafp_modi_sedo_politics_power_balance_5_country
			ig:ig_landowners.leader = {
				remove_modifier = eafp_modi_sedo_politics_power_balance_5_character
			}
		}
	}

	on_weekly_pulse = {
		effect = {
			eafp_sedo_politics_corruption_roll = yes # 사익추구 활동 굴림
			eafp_sedo_politics_lifespan_pulse = yes # 세도정치 인물 등장&퇴장

			# 왕권 강화 반복
			if = {
				limit = { is_ai = no }
				if = {
					limit = {
						has_variable = eafp_scripted_button_sedo_politics_balance_authority
						NOT = { has_variable = eafp_var_button_regent_balance_cooltime }
					}
					if = {
						limit = { authority >= 100 }
						eafp_effect_option_gain_balance = {
							BALANCE = -10
						}
						eafp_effect_option_gain_attitude = {
							ATTITUDE = -2
						}
						add_modifier = {
							name = eafp_modi_sedo_politics_balance_authority
							months = 12
						}
						set_variable = {	#쿨타임 3개월
							name = eafp_var_button_regent_balance_cooltime
							days = 90
						}
						post_notification = eafp_message_sedo_politics_balance_authority
					}
					else = {
						remove_variable = eafp_scripted_button_sedo_politics_balance_authority
						post_notification = eafp_message_sedo_politics_balance_remove
					}
				}
				if = {
					limit = {
						has_variable = eafp_scripted_button_sedo_politics_balance_bureaucracy
						NOT = { has_variable = eafp_var_button_regent_balance_cooltime }
					}
					if = {
						limit = { bureaucracy >= 0 }
						eafp_effect_option_gain_balance = {
							BALANCE = -10
						}
						eafp_effect_option_gain_attitude = {
							ATTITUDE = -2
						}
						add_modifier = {
							name = eafp_modi_sedo_politics_balance_bureaucracy
							months = 12
						}
						set_variable = {	#쿨타임 3개월
							name = eafp_var_button_regent_balance_cooltime
							days = 90
						}
						post_notification = eafp_message_sedo_politics_balance_bureaucracy
					}
					else = {
						remove_variable = eafp_scripted_button_sedo_politics_balance_bureaucracy
						post_notification = eafp_message_sedo_politics_balance_remove
					}
				}
				if = {
					limit = {
						has_variable = eafp_scripted_button_sedo_politics_balance_money
						NOT = { has_variable = eafp_var_button_regent_balance_cooltime }
					}
					if = {
						limit = { scaled_gold_reserves >= 0.1 }
						eafp_effect_option_gain_balance = {
							BALANCE = -10
						}
						eafp_effect_option_gain_attitude = {
							ATTITUDE = -2
						}
						add_treasury = {
							value = gold_reserves_limit
							multiply = -0.1
						}
						set_variable = {	#쿨타임 3개월
							name = eafp_var_button_regent_balance_cooltime
							days = 90
						}
						save_scope_value_as = {
							name = eafp_scripted_button_sedo_politics_balance_money_payment
							value = {
								value = gold_reserves_limit
								multiply = 0.1
							}
						}
						post_notification = eafp_message_sedo_politics_balance_money
					}
					else = {
						remove_variable = eafp_scripted_button_sedo_politics_balance_money
						post_notification = eafp_message_sedo_politics_balance_remove
					}
				}
			}
			else = {
				remove_variable = eafp_scripted_button_sedo_politics_balance_authority
				remove_variable = eafp_scripted_button_sedo_politics_balance_bureaucracy
				remove_variable = eafp_scripted_button_sedo_politics_balance_money
			}
		}
	}
	on_monthly_pulse = {
		effect = {
			#AI 조정
			if = {
				limit = {
					is_ai = yes
				}
				change_variable = {
					name = eafp_var_je_sedo_politics_balance
					add = -0
				}
			}
			eafp_sedo_politics_corruption_passive = yes
			if = {	#헌종 왕권 강화책 뽑기
				limit = {
					ruler = {
						has_template = eafp_kor_yi_hwan_character_template
						age >= 16
					}
				}
				eafp_sedo_politics_authority_event_roll = yes
			}
			# 
			change_variable = {
				name = eafp_var_je_sedo_politics_balance
				add = eafp_val_sedo_politics_monthly
			}
			clamp_variable = {
				name = eafp_var_je_sedo_politics_balance
				min = 0
				max = 500
			}
		}
		events = {
			eafp_kor_mainline.321
		}
	}

	weight = 1000
	
	should_be_pinned_by_default = yes
}

##유학의 왕국 - 대충 유학자나 종교, 대외관계 관련 이벤트 이모저모
je_korean_confu = {
	icon = "gfx/interface/icons/religion_icons/confucianism.dds"

	group = je_group_historical_content

	scripted_progress_bar = eafp_progress_bar_confu
	
	scripted_button = eafp_scripted_button_educating
	
	modifiers_while_active = {
		eafp_modi_confucian_state
	}

	immediate = {
		set_variable = {
			name = eafp_progress_bar_confu_from_trade_var
			value = 0
		}
	}
	
	complete = {
		custom_tooltip = {
			text = je_korean_imsul_uprising_goal
			scope:journal_entry = {
				"scripted_bar_progress(eafp_progress_bar_confu)" >= 1000
			}
		}
	}

	on_complete = {
		remove_modifier = eafp_modi_catholic_plague
		remove_variable = eafp_progress_bar_confu_from_trade_var
		trigger_event = { id = eafp_kor_mainline.171 }
		show_as_tooltip = {
			add_modifier = {
				name = eafp_modi_confucian_state_reverse
				days = normal_modifier_time
			}
			ig:ig_intelligentsia = {
				set_interest_group_name = ig_intelligentsia
				###
				add_ideology = ideology_republican
				add_ideology = ideology_anti_clerical
				remove_ideology = ideology_silhak
				set_ig_trait = ig_trait:ig_trait_social_criticism
				set_ig_trait = ig_trait:ig_trait_avant_garde
				set_ig_trait = ig_trait:ig_trait_propagandists
			}
		}
	}

	invalid = {
		NOT = { country_has_state_religion = rel:confucian }
	}

	on_invalid = {
		remove_modifier = eafp_modi_catholic_plague
		remove_variable = eafp_progress_bar_confu_from_trade_var
	}

	on_weekly_pulse = {
		effect = {
			set_local_variable = {
				name = eafp_progress_bar_confu_from_trade_locvar
				value = 0
			}
			every_country = {
				limit = { NOT = { THIS = ROOT } }
				change_local_variable = {
					name = eafp_progress_bar_confu_from_trade_locvar
					add = "mutual_trade_value_with_country(root)"
				}
			}
			set_variable = {
				name = eafp_progress_bar_confu_from_trade_var
				value = {
					value = local_var:eafp_progress_bar_confu_from_trade_locvar
					multiply = 0.05
					max = 20
				}
			}
			remove_local_variable = eafp_progress_bar_confu_from_trade_locvar
		}
	}

	on_monthly_pulse = {
		effect = {	#비랜덤성
			##캣홀릭 
			eafp_effect_cal_catholic_modi_mult = yes
			eafp_effect_catholic_spread = yes
			eafp_effect_missionary_spawn = yes
		}
		events = {
			eafp_kor_mainline.120
			eafp_kor_mainline.123
			eafp_kor_mainline.124
			eafp_kor_mainline.127
			eafp_kor_mainline.128
		}
	}

	weight = 1000
	
	should_be_pinned_by_default = yes
}

##서원
je_korean_seowon = {
	icon = "gfx/interface/icons/eafp_icons/seowon_pm_brown.png"

	group = je_group_historical_content
	
	scripted_progress_bar = eafp_progress_bar_seowon_abolish
	scripted_progress_bar = eafp_progress_bar_seowon_backlash

	scripted_button = eafp_scripted_button_seowon1
	scripted_button = eafp_scripted_button_seowon2
	scripted_button = eafp_scripted_button_seowon3
	scripted_button = eafp_scripted_button_seowon4
	scripted_button = eafp_scripted_button_seowon5
	
	modifiers_while_active = {
		eafp_modi_seowon_problem_base
	}
	
	is_shown_when_inactive = {
		country_has_primary_culture = cu:korean
		any_scope_state = {
			any_scope_building = {
				has_active_production_method = pm_manor_house_seowon_ownership
			}
		}
	}

	possible = {
		country_has_primary_culture = cu:korean
		OR = {
			any_scope_building = {
				is_building_type = building_manor_house
				NOT = { has_active_production_method = pm_manor_house_seowon_ownership }
			}
			custom_tooltip = {
				text = je_korean_land_problem_complete_cond_tt
				has_variable = eafp_var_sam_all_clear
			}
			NOT = { has_journal_entry = je_sedo_politics }
		}
	}

	immediate = {
		add_modifier = {
			name = eafp_modi_seowon_problem_backlash
			multiplier = 30
		}
		trigger_event = { id = eafp_kor_mainline.150 }
	}
	
	complete = {
		custom_tooltip = {
			text = je_korean_seowon_complete_button_tt
			has_variable = eafp_scripted_button_seowon1_var
			has_variable = eafp_scripted_button_seowon2_var
			has_variable = eafp_scripted_button_seowon3_var
			has_variable = eafp_scripted_button_seowon4_var
			has_variable = eafp_scripted_button_seowon5_var
		}
		any_scope_building = {
			count = all
			OR = {
				NOT = { is_building_type = building_manor_house }
				NOT = { has_active_production_method = pm_manor_house_seowon_ownership }
			}
		}
		custom_tooltip = {
			text = je_korean_seowon_complete_backlash_tt
			scope:journal_entry = {
				"scripted_bar_progress(eafp_progress_bar_seowon_backlash)" <= 0
			}
		}
	}

	on_complete = {
		set_variable = eafp_kor_seowon_complete
		remove_modifier = eafp_modi_seowon_problem_backlash
		trigger_event = { id = eafp_kor_mainline.159 }
	}

	on_weekly_pulse = {
		effect = {
			remove_modifier = eafp_modi_seowon_problem_backlash
			add_modifier = {
				name = eafp_modi_seowon_problem_backlash
				multiplier = eafp_progress_bar_seowon_backlash_progress_bar_value
			}
			if = {
				limit = { is_ai = yes }
				activate_production_method = {
					building_type = building_manor_house
					production_method = pm_manor_house_clergy_ownership
				}
			}
		}
	}

	weight = 1000
	
	should_be_pinned_by_default = yes
}
##

##경복궁 중건
####경복궁 중건 관련 저널들
je_rlg_seoul_gyeongbokgung_poor = {
	icon = "gfx/interface/icons/event_icons/event_map.dds"
    
	group = je_group_historical_content

	is_shown_when_inactive = {
		exists = c:KOR
		THIS = c:KOR
		any_scope_building = {
			is_building_type = building_gyeongbokgung_poor
		}
	}

	possible = {
		exists = c:KOR
		THIS = c:KOR
		any_scope_building = {
			is_building_type = building_gyeongbokgung_poor
		}
	}
    
	complete = {
		OR = {
			custom_tooltip = {
				text = je_korean_land_problem_complete_cond_tt
				has_variable = eafp_var_sam_all_clear
			}
			NOT = { has_journal_entry = je_sedo_politics }
		}
	}

	on_complete = {
		add_journal_entry = {
			type = je_rlg_seoul_gyeongbokgung_rebuild
		}
		add_technology_researched = eafp_tech_palace
	}

	should_be_pinned_by_default = no
}

je_rlg_seoul_gyeongbokgung_rebuild = {
	icon = "gfx/interface/icons/event_icons/event_industry.dds"

	group = je_group_historical_content

	complete = {
		owns_entire_state_region = STATE_SEOUL
		any_scope_building = {
			is_building_type = building_gyeongbokgung_poor
		}
		scope:journal_entry = {
			is_goal_complete = yes
		}
	}
	
	scripted_button = eafp_scripted_button_wonnap

	immediate = {
		set_variable = {
			name = eafp_var_gyeongbokgung_rebuild
			value = 0
		}
		set_variable = eafp_var_wonnap_possible
		trigger_event = {
			id = eafp_kor_mainline.1500
		}
	}

	on_complete = {
		trigger_event = {
			id = eafp_kor_mainline.1510
		}
	}
	
	on_weekly_pulse = {
		effect = {
			if = {
				limit = {
					is_ai = yes
				}
				change_variable = {
					name = eafp_var_gyeongbokgung_rebuild
					add = 5
				}
			}
			if = {
				limit = {
					any_scope_building = {
						is_building_type = building_gyeongbokgung_poor
						has_active_production_method = pm_rebuild_gyeongbokgung_1
					}
				}
				change_variable = {
					name = eafp_var_gyeongbokgung_rebuild
					add = 5
				}
			}
			if = {
				limit = {
					any_scope_building = {
						is_building_type = building_gyeongbokgung_poor
						has_active_production_method = pm_rebuild_gyeongbokgung_2
					}
				}
				change_variable = {
					name = eafp_var_gyeongbokgung_rebuild
					add = 7.5
				}
			}
			if = {
				limit = {
					any_scope_building = {
						is_building_type = building_gyeongbokgung_poor
						has_active_production_method = pm_rebuild_gyeongbokgung_3
					}
				}
				change_variable = {
					name = eafp_var_gyeongbokgung_rebuild
					add = 10
				}
			}
			if = {
				limit = {
					any_scope_building = {
						is_building_type = building_gyeongbokgung_poor
						has_active_production_method = pm_rebuild_gyeongbokgung_4
					}
				}
				change_variable = {
					name = eafp_var_gyeongbokgung_rebuild
					add = 12.5
				}
			}
		}
	}
    
	current_value = {
		value = root.var:eafp_var_gyeongbokgung_rebuild
	}

	goal_add_value = {
		add = 1000
	}
    
	progressbar = yes
    
	#fail = {
	#}

	#on_fail = {
	#}
    
	#invalid = {
	#}

	should_be_pinned_by_default = yes
}
