# ID명, 변수명은 기본적으로 일본어 음차합니다.
# weight = 12000 최중요저널 10000 중요저널 8000 일반 5000 별 의미없음

# 막번체제

je_bakuhantaisei = {
	icon = "gfx/interface/icons/alert_icons/revolution.dds"

	group = je_group_bakuhantaisei

	is_shown_in_lobby = {
		c:JAP ?= THIS
	}

	scripted_progress_bar = bakuhantaisei_bakufu_authority_progress_bar

	scripted_button = appoint_tairo_button

	immediate = {
		
	}

	modifiers_while_active = {
		bakuhantaisei_modifier
	}

	status_desc = {
		first_valid = {
			triggered_desc = { 
				desc = je_bakuhantaisei_desc_start
				trigger = {
					scope:journal_entry = {
						"scripted_bar_progress(bakuhantaisei_bakufu_authority_progress_bar)" >= 3600
					}
				}
			}
			triggered_desc = { 
				desc = je_bakuhantaisei_desc_very_low
				trigger = {
					scope:journal_entry = {
						"scripted_bar_progress(bakuhantaisei_bakufu_authority_progress_bar)" >= 3200
					}
				}
			}
			triggered_desc = { 
				desc = je_bakuhantaisei_desc_low
				trigger = {
					scope:journal_entry = {
						"scripted_bar_progress(bakuhantaisei_bakufu_authority_progress_bar)" >= 2400
					}
				}
			}
			triggered_desc = { 
				desc = je_bakuhantaisei_desc_medium
				trigger = {
					scope:journal_entry = {
						"scripted_bar_progress(bakuhantaisei_bakufu_authority_progress_bar)" >= 1600
					}
				}
			}
			triggered_desc = { 
				desc = je_bakuhantaisei_desc_high
				trigger = {
					scope:journal_entry = {
						"scripted_bar_progress(bakuhantaisei_bakufu_authority_progress_bar)" >= 800
					}
				}
			}
			desc = je_bakuhantaisei_desc_very_high
		}
	}

	complete = { 
		custom_tooltip = {
			text = bakufu_kaikaku_complete_tt
			has_variable = bakufu_kaikaku_complete_var
		}
	}

	on_complete = { 
		hidden_effect = {
			every_scope_character = {
				limit = { is_bakufu_politician = yes }
				remove_bakufu_politician_role_without_appointment = yes
			}
		}
		every_scope_state = {
			limit = { has_modifier = legacy_of_sekigahara_modifier }
			remove_modifier = legacy_of_sekigahara_modifier
		}
	}

	invalid = {
		NOT = { has_law_or_variant = law_type:law_bakufu }
	}

	on_invalid = { 
		hidden_effect = {
			every_scope_character = {
				limit = { is_bakufu_politician = yes }
				remove_bakufu_politician_role_without_appointment = yes
			}
		}
		every_scope_state = {
			limit = { has_modifier = legacy_of_sekigahara_modifier }
			remove_modifier = legacy_of_sekigahara_modifier
		}
	}

	on_weekly_pulse = {
		effect = {
			# 왠진 모르지만 막부 정치인 자리 비었을때 강제 활성화
			if = {
				limit = {
					variable_list_size = { name = roju_varlist value < 4 }
					NOT = { has_variable = recruiting_bakufu_politicians }
				}
				appoint_roju_effect = yes
			}
			else_if = {
				limit = {
					NOT = { has_variable = rojushuza_var }
					NOT = { has_variable = recruiting_bakufu_politicians }
				}
				appoint_rojushuza_effect = yes
			}
			c:NIP ?= {
				if = {
					limit = {
						is_revolutionary = yes
						is_diplomatic_play_enemy_of = ROOT
						ROOT = { has_civil_war_from_movement_type = movement_type:eafp_movement_sonno_joi }
						NOT = { has_variable = boshin_war_happened }
					}
					save_scope_as = sonno_joi_country

					add_journal_entry = {
						type = je_boshin_war_tobaku
					}
					ROOT = {
						add_journal_entry = {
							type = je_boshin_war_sabaku
						}
					}

					if = {
						limit = { NOT = { has_variable = boshin_war_happened } }
						set_variable = boshin_war_happened
						ROOT = {
							trigger_event = boshin_war.1
						}
					}
				}
			}
			# invalid한 인물이 있을 때 지움
			if = {
				limit = {
					has_variable = tairo_var
					var:tairo_var.owner != ROOT
				}
				var:tairo_var ?= { remove_bakufu_politician_role = yes }
				remove_variable = tairo_var
			}
			if = {
				limit = {
					has_variable = rojushuza_var
					var:rojushuza_var.owner != ROOT
				}
				var:rojushuza_var ?= { remove_bakufu_politician_role = yes }
				remove_variable = rojushuza_var
			}
			if = {
				limit = {
					any_in_list = {
						variable = roju_varlist
						owner != ROOT
					}
				}
				every_in_list = {
					variable = roju_varlist
					limit = { owner != ROOT }
					remove_bakufu_politician_role_without_appointment = yes
				}
			}
		}
	}

	on_monthly_pulse = {
		random_events = {
			250 = 0
			10 = eafp_japan.1003
			10 = eafp_japan.1004
			10 = eafp_japan.1005
			10 = eafp_japan.1006
			10 = eafp_japan.1015
		}
	}

	on_yearly_pulse = {
		effect = {
			every_scope_character = { # 막부 정치인 인물 사망 판정
				limit = {
					is_bakufu_politician = yes
					is_busy = yes # immortal 판정 trigger는 없음. (원래)

					NOT = { has_modifier = modifier_bakufu_recently_appointed } # 최근 임명된 놈 제외

					trigger_if = {
						limit = { modifier:character_health_add >= 1 }
						age >= {
							value = define:NCharacters|CHARACTER_LIFE_EXPECTANCY_BASE_YEARS
							add = -10 # 그냥 임의로 넣음
							add = var:CHARACTER_LIFE_EXPECTANCY_STDDEV_value
							add = {
								value = modifier:character_health_add
								add = -1
								multiply = define:NCharacters|CHARACTER_LIFE_EXPECTANCY_DELTA_YEARS_ABOVE_BASELINE
							}
						}
					}
					trigger_else = {
						age >= {
							value = define:NCharacters|CHARACTER_LIFE_EXPECTANCY_BASE_YEARS
							add = -10 # 그냥 임의로 넣음
							add = var:CHARACTER_LIFE_EXPECTANCY_STDDEV_value
							add = {
								value = modifier:character_health_add
								add = -1
								multiply = define:NCharacters|CHARACTER_LIFE_EXPECTANCY_DELTA_YEARS_BELOW_BASELINE
							}
						}
					}
				}
				trigger_event = {
					id = eafp_japan.9
					days = { 0 364 }
				}
			}
		}
	}
	
	transferable = yes

	weight = 12000

	should_be_pinned_by_default = yes
}

je_bakuhantaisei_TOHOKU = {
	icon = "gfx/interface/icons/law_icons/land_based_taxation.dds"

	group = je_group_bakuhantaisei

	scripted_progress_bar = bakuhantaisei_TOHOKU_loyalty_progress_bar
	scripted_progress_bar = bakuhantaisei_TOHOKU_independency_progress_bar
	scripted_progress_bar = bakuhantaisei_TOHOKU_goryo_progress_bar

	scripted_button = expand_goryo_TOHOKU_button
	scripted_button = reduce_goryo_TOHOKU_button

	scripted_button = reduce_nidome_TOHOKU_button
	scripted_button = reduce_nidome2_TOHOKU_button

	immediate = {
		
	}

	on_weekly_pulse = {
		effect = {
			je_bakuhantaisei_STATE_weekly_pulse = { STATE = TOHOKU }
		}
	}

	complete = {
		custom_tooltip = {
			text = bakufu_kaikaku_complete_tt
			has_variable = bakufu_kaikaku_complete_var
		}
	}

	on_complete = {
		je_bakuhantaisei_STATE_clear = { STATE = TOHOKU }
	}

	invalid = {
		OR = {
			NOT = { exists = s:STATE_TOHOKU.region_state:JAP }
			NOT = { has_law_or_variant = law_type:law_bakufu }
		}
	}

	on_invalid = {
		set_variable = {
			name = bakuhantaisei_TOHOKU_loyalty_progress_bar_value_saved
			value = bakuhantaisei_TOHOKU_loyalty_progress_bar_value
		}
		set_variable = {
			name = bakuhantaisei_TOHOKU_independency_progress_bar_value_saved
			value = bakuhantaisei_TOHOKU_independency_progress_bar_value
		}
		set_variable = {
			name = bakuhantaisei_TOHOKU_goryo_progress_bar_value_saved
			value = bakuhantaisei_TOHOKU_goryo_progress_bar_value
		}
		je_bakuhantaisei_STATE_clear = { STATE = TOHOKU }
	}

	progress_desc = je_bakuhantaisei_TOHOKU_progress

	transferable = yes

	weight = 10000

	should_be_pinned_by_default = no
}
je_bakuhantaisei_KANTO = {
	icon = "gfx/interface/icons/law_icons/land_based_taxation.dds"

	group = je_group_bakuhantaisei

	scripted_progress_bar = bakuhantaisei_KANTO_loyalty_progress_bar
	scripted_progress_bar = bakuhantaisei_KANTO_independency_progress_bar
	scripted_progress_bar = bakuhantaisei_KANTO_goryo_progress_bar

	scripted_button = expand_goryo_KANTO_button
	scripted_button = reduce_goryo_KANTO_button

	scripted_button = reduce_nidome_KANTO_button
	scripted_button = reduce_nidome2_KANTO_button

	immediate = {
		
	}

	on_weekly_pulse = {
		effect = {
			je_bakuhantaisei_STATE_weekly_pulse = { STATE = KANTO }
		}
	}

	complete = {
		custom_tooltip = {
			text = bakufu_kaikaku_complete_tt
			has_variable = bakufu_kaikaku_complete_var
		}
	}

	on_complete = {
		je_bakuhantaisei_STATE_clear = { STATE = KANTO }
	}

    invalid = {
        OR = {
            NOT = { exists = s:STATE_KANTO.region_state:JAP }
            NOT = { has_law_or_variant = law_type:law_bakufu }
        }
    }


	on_invalid = {
		set_variable = {
			name = bakuhantaisei_KANTO_loyalty_progress_bar_value_saved
			value = bakuhantaisei_KANTO_loyalty_progress_bar_value
		}
		set_variable = {
			name = bakuhantaisei_KANTO_independency_progress_bar_value_saved
			value = bakuhantaisei_KANTO_independency_progress_bar_value
		}
		set_variable = {
			name = bakuhantaisei_KANTO_goryo_progress_bar_value_saved
			value = bakuhantaisei_KANTO_goryo_progress_bar_value
		}
		je_bakuhantaisei_STATE_clear = { STATE = KANTO }
	}

	progress_desc = je_bakuhantaisei_KANTO_progress

	transferable = yes

	weight = 10000

	should_be_pinned_by_default = no
}
je_bakuhantaisei_CHUBU = {
	icon = "gfx/interface/icons/law_icons/land_based_taxation.dds"

	group = je_group_bakuhantaisei

	scripted_progress_bar = bakuhantaisei_CHUBU_loyalty_progress_bar
	scripted_progress_bar = bakuhantaisei_CHUBU_independency_progress_bar
	scripted_progress_bar = bakuhantaisei_CHUBU_goryo_progress_bar

	scripted_button = expand_goryo_CHUBU_button
	scripted_button = reduce_goryo_CHUBU_button

	scripted_button = reduce_nidome_CHUBU_button
	scripted_button = reduce_nidome2_CHUBU_button

	immediate = {
		
	}

	on_weekly_pulse = {
		effect = {
			je_bakuhantaisei_STATE_weekly_pulse = { STATE = CHUBU }
		}
	}

	complete = {
		custom_tooltip = {
			text = bakufu_kaikaku_complete_tt
			has_variable = bakufu_kaikaku_complete_var
		}
	}

	on_complete = {
		je_bakuhantaisei_STATE_clear = { STATE = CHUBU }
	}

    invalid = {
        OR = {
            NOT = { exists = s:STATE_CHUBU.region_state:JAP }
            NOT = { has_law_or_variant = law_type:law_bakufu }
        }
    }


	on_invalid = {
		set_variable = {
			name = bakuhantaisei_CHUBU_loyalty_progress_bar_value_saved
			value = bakuhantaisei_CHUBU_loyalty_progress_bar_value
		}
		set_variable = {
			name = bakuhantaisei_CHUBU_independency_progress_bar_value_saved
			value = bakuhantaisei_CHUBU_independency_progress_bar_value
		}
		set_variable = {
			name = bakuhantaisei_CHUBU_goryo_progress_bar_value_saved
			value = bakuhantaisei_CHUBU_goryo_progress_bar_value
		}
		je_bakuhantaisei_STATE_clear = { STATE = CHUBU }
	}

	progress_desc = je_bakuhantaisei_CHUBU_progress

	transferable = yes

	weight = 10000

	should_be_pinned_by_default = no
}
je_bakuhantaisei_KANSAI = {
	icon = "gfx/interface/icons/law_icons/land_based_taxation.dds"

	group = je_group_bakuhantaisei

	scripted_progress_bar = bakuhantaisei_KANSAI_loyalty_progress_bar
	scripted_progress_bar = bakuhantaisei_KANSAI_independency_progress_bar
	scripted_progress_bar = bakuhantaisei_KANSAI_goryo_progress_bar

	scripted_button = expand_goryo_KANSAI_button
	scripted_button = reduce_goryo_KANSAI_button

	scripted_button = reduce_nidome_KANSAI_button
	scripted_button = reduce_nidome2_KANSAI_button

	immediate = {
		
	}

	on_weekly_pulse = {
		effect = {
			je_bakuhantaisei_STATE_weekly_pulse = { STATE = KANSAI }
		}
	}

	complete = {
		custom_tooltip = {
			text = bakufu_kaikaku_complete_tt
			has_variable = bakufu_kaikaku_complete_var
		}
	}

	on_complete = {
		je_bakuhantaisei_STATE_clear = { STATE = KANSAI }
	}

    invalid = {
        OR = {
            NOT = { exists = s:STATE_KANSAI.region_state:JAP }
            NOT = { has_law_or_variant = law_type:law_bakufu }
        }
    }


	on_invalid = {
		set_variable = {
			name = bakuhantaisei_KANSAI_loyalty_progress_bar_value_saved
			value = bakuhantaisei_KANSAI_loyalty_progress_bar_value
		}
		set_variable = {
			name = bakuhantaisei_KANSAI_independency_progress_bar_value_saved
			value = bakuhantaisei_KANSAI_independency_progress_bar_value
		}
		set_variable = {
			name = bakuhantaisei_KANSAI_goryo_progress_bar_value_saved
			value = bakuhantaisei_KANSAI_goryo_progress_bar_value
		}
		je_bakuhantaisei_STATE_clear = { STATE = KANSAI }
	}

	progress_desc = je_bakuhantaisei_KANSAI_progress

	transferable = yes

	weight = 10000

	should_be_pinned_by_default = no
}
je_bakuhantaisei_KYUSHU = {
	icon = "gfx/interface/icons/law_icons/land_based_taxation.dds"

	group = je_group_bakuhantaisei

	scripted_progress_bar = bakuhantaisei_KYUSHU_loyalty_progress_bar
	scripted_progress_bar = bakuhantaisei_KYUSHU_independency_progress_bar
	scripted_progress_bar = bakuhantaisei_KYUSHU_goryo_progress_bar

	scripted_button = expand_goryo_KYUSHU_button
	scripted_button = reduce_goryo_KYUSHU_button

	scripted_button = reduce_nidome_KYUSHU_button
	scripted_button = reduce_nidome2_KYUSHU_button

	immediate = {
		
	}

	on_weekly_pulse = {
		effect = {
			je_bakuhantaisei_STATE_weekly_pulse = { STATE = KYUSHU }
		}
	}

	complete = {
		custom_tooltip = {
			text = bakufu_kaikaku_complete_tt
			has_variable = bakufu_kaikaku_complete_var
		}
	}

	on_complete = {
		je_bakuhantaisei_STATE_clear = { STATE = KYUSHU }
	}

    invalid = {
        OR = {
            NOT = { exists = s:STATE_KYUSHU.region_state:JAP }
            NOT = { has_law_or_variant = law_type:law_bakufu }
        }
    }


	on_invalid = {
		set_variable = {
			name = bakuhantaisei_KYUSHU_loyalty_progress_bar_value_saved
			value = bakuhantaisei_KYUSHU_loyalty_progress_bar_value
		}
		set_variable = {
			name = bakuhantaisei_KYUSHU_independency_progress_bar_value_saved
			value = bakuhantaisei_KYUSHU_independency_progress_bar_value
		}
		set_variable = {
			name = bakuhantaisei_KYUSHU_goryo_progress_bar_value_saved
			value = bakuhantaisei_KYUSHU_goryo_progress_bar_value
		}
		je_bakuhantaisei_STATE_clear = { STATE = KYUSHU }
	}

	progress_desc = je_bakuhantaisei_KYUSHU_progress

	transferable = yes

	weight = 10000

	should_be_pinned_by_default = no
}
je_bakuhantaisei_CHUGOKU = {
	icon = "gfx/interface/icons/law_icons/land_based_taxation.dds"

	group = je_group_bakuhantaisei

	scripted_progress_bar = bakuhantaisei_CHUGOKU_loyalty_progress_bar
	scripted_progress_bar = bakuhantaisei_CHUGOKU_independency_progress_bar
	scripted_progress_bar = bakuhantaisei_CHUGOKU_goryo_progress_bar

	scripted_button = expand_goryo_CHUGOKU_button
	scripted_button = reduce_goryo_CHUGOKU_button

	scripted_button = reduce_nidome_CHUGOKU_button
	scripted_button = reduce_nidome2_CHUGOKU_button

	immediate = {
		
	}

	on_weekly_pulse = {
		effect = {
			je_bakuhantaisei_STATE_weekly_pulse = { STATE = CHUGOKU }
		}
	}

	complete = {
		custom_tooltip = {
			text = bakufu_kaikaku_complete_tt
			has_variable = bakufu_kaikaku_complete_var
		}
	}

	on_complete = {
		je_bakuhantaisei_STATE_clear = { STATE = CHUGOKU }
	}

    invalid = {
        OR = {
            NOT = { exists = s:STATE_CHUGOKU.region_state:JAP }
            NOT = { has_law_or_variant = law_type:law_bakufu }
        }
    }


	on_invalid = {
		set_variable = {
			name = bakuhantaisei_CHUGOKU_loyalty_progress_bar_value_saved
			value = bakuhantaisei_CHUGOKU_loyalty_progress_bar_value
		}
		set_variable = {
			name = bakuhantaisei_CHUGOKU_independency_progress_bar_value_saved
			value = bakuhantaisei_CHUGOKU_independency_progress_bar_value
		}
		set_variable = {
			name = bakuhantaisei_CHUGOKU_goryo_progress_bar_value_saved
			value = bakuhantaisei_CHUGOKU_goryo_progress_bar_value
		}
		je_bakuhantaisei_STATE_clear = { STATE = CHUGOKU }
	}

	progress_desc = je_bakuhantaisei_CHUGOKU_progress

	transferable = yes

	weight = 10000

	should_be_pinned_by_default = no
}
je_bakuhantaisei_SHIKOKU = {
	icon = "gfx/interface/icons/law_icons/land_based_taxation.dds"

	group = je_group_bakuhantaisei

	scripted_progress_bar = bakuhantaisei_SHIKOKU_loyalty_progress_bar
	scripted_progress_bar = bakuhantaisei_SHIKOKU_independency_progress_bar
	scripted_progress_bar = bakuhantaisei_SHIKOKU_goryo_progress_bar

	scripted_button = expand_goryo_SHIKOKU_button
	scripted_button = reduce_goryo_SHIKOKU_button

	scripted_button = reduce_nidome_SHIKOKU_button
	scripted_button = reduce_nidome2_SHIKOKU_button

	immediate = {
		
	}

	on_weekly_pulse = {
		effect = {
			je_bakuhantaisei_STATE_weekly_pulse = { STATE = SHIKOKU }
		}
	}

	complete = {
		custom_tooltip = {
			text = bakufu_kaikaku_complete_tt
			has_variable = bakufu_kaikaku_complete_var
		}
	}

	on_complete = {
		je_bakuhantaisei_STATE_clear = { STATE = SHIKOKU }
	}

    invalid = {
        OR = {
            NOT = { exists = s:STATE_SHIKOKU.region_state:JAP }
            NOT = { has_law_or_variant = law_type:law_bakufu }
        }
    }


	on_invalid = {
		set_variable = {
			name = bakuhantaisei_SHIKOKU_loyalty_progress_bar_value_saved
			value = bakuhantaisei_SHIKOKU_loyalty_progress_bar_value
		}
		set_variable = {
			name = bakuhantaisei_SHIKOKU_independency_progress_bar_value_saved
			value = bakuhantaisei_SHIKOKU_independency_progress_bar_value
		}
		set_variable = {
			name = bakuhantaisei_SHIKOKU_goryo_progress_bar_value_saved
			value = bakuhantaisei_SHIKOKU_goryo_progress_bar_value
		}
		je_bakuhantaisei_STATE_clear = { STATE = SHIKOKU }
	}

	progress_desc = je_bakuhantaisei_SHIKOKU_progress

	transferable = yes

	weight = 10000

	should_be_pinned_by_default = no
}

# 홋카이도

je_hokkaido = {
	icon = "gfx/interface/icons/law_icons/frontier_colonization.dds"

	group = je_group_historical_content

	scripted_progress_bar = hokkaido_progress_bar

	scripted_button = make_into_shogunate_domain_button
	scripted_button = strengthen_merchant_surveillance_button
	scripted_button = encourage_ezo_japanization_button
	scripted_button = construct_hokkaido_castle_button

	immediate = {
		s:STATE_HOKKAIDO.region_state:JAP = {
			add_modifier = disorganized_bashoukeoisei_modifier
			add_modifier = matsumae_han_modifier
		}
	}

	complete = {
		owns_entire_state_region = STATE_HOKKAIDO
		s:STATE_HOKKAIDO.region_state:JAP = {
			NOT = { has_modifier = matsumae_han_modifier }
			NOT = { has_modifier = disorganized_bashoukeoisei_modifier }
		}
		custom_tooltip = {
			text = je_hokkaido_complete_tt
			s:STATE_HOKKAIDO.region_state:JAP.state_population >= 400000
		}
	}

	on_complete = {
		s:STATE_HOKKAIDO = {
			every_scope_state = {
				if = {
					limit = { has_modifier = matsumae_han_modifier }
					remove_modifier = matsumae_han_modifier
				}
				if = {
					limit = { has_modifier = bashoukeoisei_modifier }
					remove_modifier = bashoukeoisei_modifier
				}
				if = {
					limit = { has_modifier = disorganized_bashoukeoisei_modifier }
					remove_modifier = disorganized_bashoukeoisei_modifier
				}
			}
		}
		trigger_event = { id = hokkaido.1 }
	}

	on_monthly_pulse = {
		random_events = {
			1 = hokkaido.5
			1 = hokkaido.6
			22 = 0
		}
	}

	weight = 8000

}

# 텐포 대기근

je_tenpo_famine = {
	icon = "gfx/interface/icons/event_icons/event_skull.dds"

	group = je_group_historical_content

	immediate = {
		# 텐포 대기근 변화 요인는 history에서
		# 이미 구호소 운영중
		set_variable = {
			name = sukuigoya_for_tenpo
			value = 2
		}
		add_modifier = {
			name = modifier_sukuigoya_for_tenpo
			multiplier = var:sukuigoya_for_tenpo
		}
		set_variable = {
			name = sukuigoya_for_tenpo_accumulation
			value = 0
		}
		trigger_event = {
			id = tenpo_famine.2
			months = 1
		}
		trigger_event = {
			id = tenpo_famine.3
			months = 2
		}
		trigger_event = {
			id = tenpo_famine.5
			days = 448 # 1년 83일
		}
	}

	scripted_button = install_sukuigoya_button
	scripted_button = expand_sukuigoya_button
	scripted_button = close_sukuigoya_button
	scripted_button = reduce_sukuigoya_button

	status_desc = je_tenpo_famine_status

	on_monthly_pulse = {
		effect = {
			if = {
				limit = { has_variable = sukuigoya_for_tenpo }
				change_variable = {
					name = sukuigoya_for_tenpo_accumulation
					add = var:sukuigoya_for_tenpo
				}
			}
		}
		random_events = {
			chance_of_no_event = {
				value = 2
				if = {
					limit = { has_variable = sukuigoya_for_tenpo }
					add = var:sukuigoya_for_tenpo
				}
			}
			1 = 0
			1 = tenpo_famine.4
		}
	}

	complete = {
		NOT = {
			any_scope_state = {
				state_is_in_japan = yes
				OR = {
					state_region = { has_harvest_condition = flood }
					has_famine = yes
				}
			}
		}
	}

	on_complete = {
		trigger_event = { id = tenpo_famine.99 }
	}

	weight = 10000
	should_be_pinned_by_default = yes
}

# 막부 개혁

je_bakufu_kaikaku = {
	icon = "gfx/interface/icons/objectives/egalitarian_society.dds"

	group = je_group_historical_content

	is_shown_in_lobby = {
		c:JAP ?= THIS
	}

	scripted_progress_bar = bakufu_kaikaku_progress_bar
	scripted_progress_bar = bakufu_kaikaku_hitotsubashiha_approval_progress_bar
	scripted_progress_bar = bakufu_kaikaku_nankiha_approval_progress_bar

	scripted_button = japan_kaikakuha_button
	scripted_button = japan_hoshuha_button
	scripted_button = japan_bakufu_kaikaku_button
	
	scripted_button = repeal_ikokusen_uchiharairei_button
	scripted_button = reenact_ikokusen_uchiharairei_button
	scripted_button = shogun_marry_with_princess_button

	scripted_button = bakufu_seisaku_new_currency_start_button
	scripted_button = bakufu_seisaku_junochisui_start_button
	scripted_button = bakufu_seisaku_agechirei_start_button
	scripted_button = bakufu_seisaku_kokishukusei_start_button
	
	status_desc = {
		
	}

	progress_desc = {
		first_valid = {
			
		}
	}

	immediate = {
		# hitotsubashiha_influence_var와 nankiha_influence_var는 history에서 설정

		weekly_pulse_bakufu_kaikaku_progress_bar_faction = yes
	}

	

	complete = { 
		custom_tooltip = {
			text = bakufu_kaikaku_kaikoku_clear
			has_variable = bakufu_kaikaku_kaikoku_complete_var
		}
		custom_tooltip = {
			text = bakufu_kaikaku_zaisei_clear
			has_variable = bakufu_kaikaku_zaisei_complete_var
		}
		custom_tooltip = {
			text = bakufu_kaikaku_guntai_clear
			has_variable = bakufu_kaikaku_guntai_complete_var
		}
		custom_tooltip = {
			text = bakufu_kaikaku_naibu_clear
			has_variable = bakufu_kaikaku_naibu_complete_var
		}
	}

	on_complete = {
		hidden_effect = {
			# 파벌에 따른 다이묘 approval
			remove_modifier = bakufu_kaikaku_daimyo_approval_positive_modifier
			remove_modifier = bakufu_kaikaku_daimyo_approval_negative_modifier
			set_local_variable = {
				name = modifier_multiplier
				value = {
					je:je_bakufu_kaikaku = {
						value = "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)"
						subtract = 50
						multiply = ROOT.bakufu_hitotsubashiha_hiritsu
						add = {
							value = "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)"
							subtract = 50
							multiply = ROOT.bakufu_nankiha_hiritsu
						}
						divide = 50
					}
				}
			}
			if = {
				limit = { local_var:modifier_multiplier >= 0 }
				add_modifier = {
					name = bakufu_kaikaku_daimyo_approval_positive_modifier
					multiplier = local_var:modifier_multiplier
					months = 24
					is_decaying = yes
				}
			}
			else = {
				add_modifier = {
					name = bakufu_kaikaku_daimyo_approval_negative_modifier
					multiplier = {
						value = local_var:modifier_multiplier
						multiply = -1
					}
					months = 24
					is_decaying = yes
				}
			}
			# 파벌의 영향력 차이에 대한 변화 요인
			remove_modifier = bakufu_kaikaku_daimyo_influence_modifier
			add_modifier = {
				name = bakufu_kaikaku_daimyo_influence_modifier
				multiplier = {
					value = 0.25
					subtract = {
						value = bakufu_hitotsubashiha_hiritsu
						multiply = bakufu_nankiha_hiritsu
					}
					multiply = 4
				}
				months = 24
				is_decaying = yes
			}

			remove_variable = hitotsubashiha_influence_var_monthly_add
			remove_variable = nankiha_influence_var_monthly_add
			set_variable = bakufu_kaikaku_complete_var
		}

		trigger_event = { id = eafp_japan.2999 }
	}

	invalid = {
		NOT = { has_journal_entry = je_bakuhantaisei }
	}

	on_invalid = {
		hidden_effect = {
			# 파벌에 따른 다이묘 approval
			remove_modifier = bakufu_kaikaku_daimyo_approval_positive_modifier
			remove_modifier = bakufu_kaikaku_daimyo_approval_negative_modifier
			set_local_variable = {
				name = modifier_multiplier
				value = {
					je:je_bakufu_kaikaku = {
						value = "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)"
						subtract = 50
						multiply = ROOT.bakufu_hitotsubashiha_hiritsu
						add = {
							value = "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)"
							subtract = 50
							multiply = ROOT.bakufu_nankiha_hiritsu
						}
						divide = 50
					}
				}
			}
			if = {
				limit = { local_var:modifier_multiplier >= 0 }
				add_modifier = {
					name = bakufu_kaikaku_daimyo_approval_positive_modifier
					multiplier = local_var:modifier_multiplier
					months = 24
					is_decaying = yes
				}
			}
			else = {
				add_modifier = {
					name = bakufu_kaikaku_daimyo_approval_negative_modifier
					multiplier = {
						value = local_var:modifier_multiplier
						multiply = -1
					}
					months = 24
					is_decaying = yes
				}
			}
			# 파벌의 영향력 차이에 대한 변화 요인
			remove_modifier = bakufu_kaikaku_daimyo_influence_modifier
			add_modifier = {
				name = bakufu_kaikaku_daimyo_influence_modifier
				multiplier = {
					value = 0.25
					subtract = {
						value = bakufu_hitotsubashiha_hiritsu
						multiply = bakufu_nankiha_hiritsu
					}
					multiply = 4
				}
				months = 24
				is_decaying = yes
			}

			remove_variable = hitotsubashiha_influence_var_monthly_add
			remove_variable = nankiha_influence_var_monthly_add
			set_variable = bakufu_kaikaku_complete_var
		}
	}

	on_monthly_pulse = {
		effect = {
			bakufu_kaikaku_progress_bar_monthly_calc = yes

			# 히토츠바시 vs 난키 대립 이벤트
			random_list = {
				2000 = {  }
				100 = {
					modifier = {
						if = { # 장군계각문제 시작 안하면 깎음
							limit = { NOT = { has_variable = hitotsubashiha_vs_nankiha_start } }
							add = -100
						}
						if = { # 고립주의 아님
							limit = { NOT = { has_law_or_variant = law_type:law_isolationism } }
							add = 200
						}
						if = { # 막번체제 저널 진행도
							limit = { je:je_bakuhantaisei = { "scripted_bar_progress(bakuhantaisei_bakufu_authority_progress_bar)" <= 2000 }  }
							add = 100
						}
						if = { # 막번체제 저널 진행도
							limit = { je:je_bakuhantaisei = { "scripted_bar_progress(bakuhantaisei_bakufu_authority_progress_bar)" <= 1000 } }
							add = 100
						}
						if = { # 히토츠바시파의 approval
							limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)" <= 50 } }
							add = 100
						}
						if = { # 히토츠바시파의 approval
							limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)" <= 25 } }
							add = 200
						}
						if = { # 난키파의 approval
							limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)" <= 50 } }
							add = 100
						}
						if = { # 난키파의 approval
							limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)" <= 25 } }
							add = 200
						}
					}
					random_list = {
						100 = {
							modifier = {
								if = { # 히토츠바시파의 approval
									limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)" >= 80 } }
									add = -25
								}
								if = { # 히토츠바시파의 approval
									limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)" >= 60 } }
									add = -25
								}
								if = { # 히토츠바시파의 approval
									limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)" >= 40 } }
									add = -25
								}
								if = { # 히토츠바시파의 approval
									limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)" >= 20 } }
									add = -25
								}
							}
							random_list = {
								100 = { # 난키파 정치인 암살
									trigger = {
										je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)" <= 40 }
										any_scope_character = {
											is_bakufu_politician = yes
											is_nankiha = yes
										}
									}
									trigger_event = {
										id = eafp_japan.2182
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 난키파 축출
									trigger = {
										bakufu_hitotsubashiha_hiritsu >= 0.7
										any_scope_character = {
											is_bakufu_politician = yes
											is_nankiha = yes
											count >= 3
										}
									}
									trigger_event = {
										id = eafp_japan.2184
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 히토츠바시파의 이국선타불령 부활 요구
									trigger = {
										has_law_or_variant = law_type:law_isolationism
										NOT = { has_modifier = ikokusen_uchiharairei_modifier }
										NOT = { has_variable = eafpjap2301_cooldown }
									}
									trigger_event = {
										id = eafp_japan.2301
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 난키파 정치인 사임 요구
									trigger = {
										NOT = { has_journal_entry = je_eafpjap2311 }
										any_scope_character = {
											is_bakufu_politician = yes
											is_nankiha = yes
										}
									}
									trigger_event = {
										id = eafp_japan.2311
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 히토츠바시파의 정략결혼 요구
									trigger = {
										NOT = { has_variable = eafpjap2307_cooldown }
										ruler = {
											age > 16
											NOT = { has_variable = is_married }
										}
									}
									trigger_event = {
										id = eafp_japan.2307
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 히토츠바시파의 교토 상경 요구
									trigger = {
										NOT = { has_variable = eafpjap2308_cooldown }
										NOT = { has_modifier = shogun_meet_emperor_modifier }
									}
									trigger_event = {
										id = eafp_japan.2308
										days = { 1 30 }
										popup = yes
									}
								}
							}
						}
						100 = {
							modifier = {
								if = { # 난키파의 approval
									limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)" >= 80 } }
									add = -25
								}
								if = { # 난키파의 approval
									limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)" >= 60 } }
									add = -25
								}
								if = { # 난키파의 approval
									limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)" >= 40 } }
									add = -25
								}
								if = { # 난키파의 approval
									limit = { je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)" >= 20 } }
									add = -25
								}
							}
							random_list = {
								100 = { # 히토츠바시파 정치인 암살
									trigger = {
										je:je_bakufu_kaikaku = { "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)" <= 40 }
										any_scope_character = {
											is_bakufu_politician = yes
											is_hitotsubashiha = yes
										}
									}
									trigger_event = {
										id = eafp_japan.2181
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 히토츠바시파 축출
									trigger = {
										bakufu_nankiha_hiritsu >= 0.7
										any_scope_character = {
											is_bakufu_politician = yes
											is_hitotsubashiha = yes
											count >= 3
										}
									}
									trigger_event = {
										id = eafp_japan.2183
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 히토츠바시파 정치인 사임 요구
									trigger = {
										NOT = { has_journal_entry = je_eafpjap2310 }
										any_scope_character = {
											is_bakufu_politician = yes
											is_hitotsubashiha = yes
										}
									}
									trigger_event = {
										id = eafp_japan.2310
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 난키파의 이국선타불령 폐지 요구
									trigger = {
										has_law_or_variant = law_type:law_isolationism
										has_modifier = ikokusen_uchiharairei_modifier
										NOT = { has_variable = eafpjap2306_cooldown }
									}
									trigger_event = {
										id = eafp_japan.2306
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 난키파의 막부 개혁 시행 요구 - 새 화폐 도입
									trigger = {
										NOT = { has_variable = je_bakufu_seisaku_new_currency_start }
										NOT = { has_variable = eafpjap2302_cooldown }
										has_technology_researched = currency_standards
									}
									trigger_event = {
										id = eafp_japan.2302
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 난키파의 막부 개혁 시행 요구 - 중농치수
									trigger = {
										NOT = { has_variable = je_bakufu_seisaku_new_currency_start }
										NOT = { has_variable = eafpjap2303_cooldown }
										exists = s:STATE_KANTO.region_state:JAP
										exists = s:STATE_KANSAI.region_state:JAP
									}
									trigger_event = {
										id = eafp_japan.2303
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 난키파의 막부 개혁 시행 요구 - 상지령
									trigger = {
										NOT = { has_variable = je_bakufu_seisaku_new_currency_start }
										NOT = { has_variable = eafpjap2304_cooldown }
										exists = s:STATE_KANTO.region_state:JAP
										exists = s:STATE_KANSAI.region_state:JAP
									}
									trigger_event = {
										id = eafp_japan.2304
										days = { 1 30 }
										popup = yes
									}
								}
								100 = { # 난키파의 막부 개혁 시행 요구 - 강기숙정
									trigger = {
										NOT = { has_variable = je_bakufu_seisaku_new_currency_start }
										NOT = { has_variable = eafpjap2305_cooldown }
										has_technology_researched = mass_communication
									}
									trigger_event = {
										id = eafp_japan.2305
										days = { 1 30 }
										popup = yes
									}
								}
							}
						}
					}
				}
			}

			weekly_pulse_bakufu_kaikaku_progress_bar_faction = yes
		}

		random_events = {
			190 = 0
			10 = eafp_japan.4005
			20 = eafp_japan.4008
			20 = eafp_japan.4009
		}
	}

	on_weekly_pulse = {
		effect = {
			weekly_pulse_bakufu_kaikaku_progress_bar_faction = yes
			# 파벌에 따른 다이묘 approval - 초기 설정은 history에서 함
			remove_modifier = bakufu_kaikaku_daimyo_approval_positive_modifier
			remove_modifier = bakufu_kaikaku_daimyo_approval_negative_modifier
			set_local_variable = {
				name = modifier_multiplier
				value = {
					je:je_bakufu_kaikaku = {
						value = "scripted_bar_progress(bakufu_kaikaku_hitotsubashiha_approval_progress_bar)"
						subtract = 50
						multiply = ROOT.bakufu_hitotsubashiha_hiritsu
						add = {
							value = "scripted_bar_progress(bakufu_kaikaku_nankiha_approval_progress_bar)"
							subtract = 50
							multiply = ROOT.bakufu_nankiha_hiritsu
						}
						divide = 50
					}
				}
			}
			if = {
				limit = { local_var:modifier_multiplier >= 0 }
				add_modifier = {
					name = bakufu_kaikaku_daimyo_approval_positive_modifier
					multiplier = local_var:modifier_multiplier
				}
			}
			else = {
				add_modifier = {
					name = bakufu_kaikaku_daimyo_approval_negative_modifier
					multiplier = {
						value = local_var:modifier_multiplier
						multiply = -1
					}
				}
			}
			# 파벌의 영향력 차이에 대한 변화 요인 - 초기 설정은 history에서 함
			remove_modifier = bakufu_kaikaku_daimyo_influence_modifier
			add_modifier = {
				name = bakufu_kaikaku_daimyo_influence_modifier
				multiplier = {
					value = 0.25
					subtract = {
						value = bakufu_hitotsubashiha_hiritsu
						multiply = bakufu_nankiha_hiritsu
					}
					multiply = 4
				}
			}
		}
	}

	weight = 12000

	should_be_pinned_by_default = yes
}

je_bakufu_kaikoku = { # je_meiji_diplomacy에 대응
	icon = "gfx/interface/icons/event_icons/event_trade.dds"

	group = je_group_historical_content

	complete = { 
		NOT = { has_law_or_variant = law_type:law_isolationism }
		NOT = { has_law_or_variant = law_type:law_traditionalism }
		NOT = { has_law_or_variant = law_type:law_closed_borders }
		is_subject = no
	}

	on_complete = { 
		custom_tooltip = {
			text = complete_kaikaku
			set_variable = bakufu_kaikaku_kaikoku_complete_var
		}
		remove_modifier = bakufu_corruption_dip
		add_modifier = {
			name = modifier_bakufu_kaikoku_complete
			months = 60
		}
	}

	on_monthly_pulse = {
		random_events = {
			100 = 0
			10 = meiji.5
			10 = meiji.11
			10 = meiji.12
		}
	}

	invalid = {
		NOT = { has_journal_entry = je_bakufu_kaikaku }
	}

	on_invalid = {
		remove_modifier = bakufu_corruption_dip
	}

	weight = 10000
}

je_bakufu_guntai = { # je_meiji_army에 대응
	icon = "gfx/interface/icons/war_goals/conquer_state.dds"

	group = je_group_historical_content

	complete = {
		NOT = { has_law_or_variant = law_type:law_serfdom }
		army_size >= 100
		navy_size >= 10
		has_technology_researched = napoleonic_warfare
		NOR = {
			any_scope_building = {
				is_building_type = building_barracks
				has_active_production_method = pm_no_organization
			}
			any_military_formation = {
				filter = {
					is_army = yes
				}
				any_combat_unit = {
					has_unit_type = unit_type:combat_unit_type_irregular_infantry
				}
				percent >= 0.25
			}
		}
		any_scope_building = { 
			is_building_type = building_arms_industry
			OR = {
				has_active_production_method = pm_rifles
				has_active_production_method = pm_repeaters
				has_active_production_method = pm_bolt_action_rifles
			}
			level >= 5
			occupancy >= 0.75
		}
	}

	on_complete = { 
		custom_tooltip = {
			text = complete_kaikaku
			set_variable = bakufu_kaikaku_guntai_complete_var
		}
		remove_modifier = bakufu_corruption_mil
		add_modifier = {
			name = modifier_bakufu_guntai_complete
			months = 60
		}
		trigger_event = {
			id = meiji.3
		}
	}

	on_monthly_pulse = {
		random_events = {
			50 = 0
			10 = meiji.4
			10 = meiji.9
			10 = meiji.10
			50 = eafp_japan.2401
		}
	}

	invalid = {
		NOT = { has_journal_entry = je_bakufu_kaikaku }
	}

	on_invalid = {
		remove_modifier = bakufu_corruption_mil
	}

	weight = 10000

}

je_bakufu_naibu = { # je_meiji_restoration에 대응
	icon = "gfx/interface/icons/pops_icons/bureaucrats.dds"

	group = je_group_historical_content

	immediate = {
		set_variable = {
			name = shogunate_var
			value = 0
		}
	}

	complete = { 
		scope:journal_entry = { is_goal_complete = yes }

		has_law_or_variant = law_type:law_monarchy
		has_law_or_variant = law_type:law_bakufu
		NOT = { has_modifier = declared_bankruptcy }
		ig:ig_landowners = {
			is_in_government = yes
		}
		has_insurrectionary_interest_groups = no
		bureaucracy >= 0
		any_scope_building = {
			is_building_type = building_university
			occupancy > 0.9
			level >= 5
		}
		literacy_rate >= 0.25
	}

	on_complete = { 
		custom_tooltip = {
			text = complete_kaikaku
			set_variable = bakufu_kaikaku_naibu_complete_var
		}
		remove_modifier = bakufu_corruption_adm
		add_modifier = {
			name = modifier_bakufu_naibu_complete
			months = 60
		}
	}

	is_progressing = {
		has_law_or_variant = law_type:law_monarchy
		has_law_or_variant = law_type:law_bakufu
		NOT = { has_modifier = declared_bankruptcy }
		ig:ig_landowners = {
			is_in_government = yes
		}
		has_insurrectionary_interest_groups = no
		is_at_war = no
		government_legitimacy >= 80
		bureaucracy >= 0
		any_scope_building = {
			is_building_type = building_university
			occupancy > 0.9
			level >= 5
		}
		literacy_rate >= 0.25
	}

	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					has_law_or_variant = law_type:law_monarchy
					has_law_or_variant = law_type:law_bakufu
					NOT = { has_modifier = declared_bankruptcy }
					ig:ig_landowners = {
						is_in_government = yes
					}
					has_insurrectionary_interest_groups = no
					is_at_war = no
					government_legitimacy >= 80
					bureaucracy >= 0
					any_scope_building = {
						is_building_type = building_university
						occupancy > 0.9
						level >= 5
					}
					literacy_rate >= 0.25
				}
				change_variable = {
					name = shogunate_var
					add = 1
				}
			}
		}
	}

	invalid = {
		NOT = { has_journal_entry = je_bakufu_kaikaku }
	}

	on_invalid = {
		remove_modifier = bakufu_corruption_adm
	}

	current_value = {
		value = root.var:shogunate_var
	}

	goal_add_value = {
		value = 120
	}

	progressbar = yes

	weight = 10000
}

je_bakufu_zaisei = { # je_meiji_economy에 대응
	icon = "gfx/interface/icons/event_icons/event_industry.dds"

	group = je_group_historical_content

	complete = { 
		scope:journal_entry = {
			is_goal_complete = yes
		}
		gold_reserves > 0
		any_scope_state = {
			is_incorporated = yes
			any_scope_building = {
				is_building_type = building_urban_center
				level >= 8
			}
		}
	}

	on_complete = { 
		custom_tooltip = {
			text = complete_kaikaku
			set_variable = bakufu_kaikaku_zaisei_complete_var
		}
		remove_modifier = bakufu_corruption_fin
		add_modifier = {
			name = modifier_bakufu_zaisei_complete
			months = 60
		}
	}

	on_monthly_pulse = {
		random_events = {
			100 = 0
			10 = meiji.6
			10 = meiji.7
			10 = meiji.8
		}
	}

	invalid = {
		NOT = { has_journal_entry = je_bakufu_kaikaku }
	}

	on_invalid = {
		remove_modifier = bakufu_corruption_fin
	}

	current_value = {
		value = root.gdp
	}

	goal_add_value = {
		value = root.gdp
		multiply = 0.5
	}

	progressbar = yes

	weight = 10000

}

# 파벌 탄원

je_eafpjap2310 = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	group = je_group_internal_affairs

	complete = {
		custom_tooltip = {
			text = target_character_resigned_tt
			OR = {
				NOT = { exists = scope:target }
				NOT = { scope:target = { is_bakufu_politician = yes } }
			}
		}
	}

	on_complete = { 
		add_nankiha_approval = {
			VALUE = 10
		}
	}

	invalid = {
		NOT = { has_journal_entry = je_bakuhantaisei }
	}

	on_timeout = {
		add_nankiha_approval = {
			VALUE = -10
		}
	}

	timeout = 365

	weight = 1000

	should_be_pinned_by_default = yes

}

je_eafpjap2311 = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	group = je_group_internal_affairs

	complete = {
		custom_tooltip = {
			text = target_character_resigned_tt
			OR = {
				NOT = { exists = scope:target }
				NOT = { scope:target = { is_bakufu_politician = yes } }
			}
		}
	}

	on_complete = { 
		add_hitotsubashiha_approval = {
			VALUE = 10
		}
	}

	invalid = {
		NOT = { has_journal_entry = je_bakuhantaisei }
	}

	on_timeout = {
		add_hitotsubashiha_approval = {
			VALUE = -10
		}
	}

	timeout = 365

	weight = 1000

	should_be_pinned_by_default = yes

}

# 보신전쟁

je_boshin_war_sabaku = {
	icon = "gfx/interface/icons/ig_icons/armed_forces.dds"

	group = je_group_historical_content

	complete = {
		NOT = {
			any_civil_war = {
				political_movement = {
					is_political_movement_type = eafp_movement_sonno_joi
				}
			}
		}
		has_law_or_variant = law_type:law_bakufu
	}

	on_complete = {
		trigger_event = boshin_war.9
		change_tag = JAP
	}

	invalid = {
		NOT = { has_law_or_variant = law_type:law_bakufu }
	}

	on_weekly_pulse = {
		effect = {
			random_scope_war = {
				limit = {
					is_warleader = c:JAP
					is_warleader = c:NIP
				}
				add_war_war_support = { target = ROOT value = 5 }
			}
		}
	}

	weight = 20000

	should_be_pinned_by_default = yes
}

je_boshin_war_tobaku = {
	icon = "gfx/interface/icons/ig_icons/armed_forces.dds"

	group = je_group_historical_content

	complete = {
		NOT = {
			c:JAP = {
				any_civil_war = {
					political_movement = {
						is_political_movement_type = eafp_movement_sonno_joi
					}
				}
			}
		}
		NOT = { has_law_or_variant = law_type:law_bakufu }
	}

	on_complete = {
		trigger_event = {
			id = meiji.1
			popup = yes
		}
		change_tag = JAP
		hidden_effect = {
			set_variable = {
				name = meiji_var
				value = 0
			}
			remove_modifier = modifier_japan_hiring_bonus
		}
	}

	invalid = {
		has_law_or_variant = law_type:law_bakufu
	}

	on_weekly_pulse = {
		effect = {
			random_scope_war = {
				limit = {
					is_warleader = c:JAP
					is_warleader = c:NIP
				}
				add_war_war_support = { target = ROOT value = 5 }
			}
		}
	}

	weight = 20000

	should_be_pinned_by_default = yes
}

# 자유민권운동

je_liberty_civil_right_movement = {
	icon = "gfx/interface/icons/event_icons/waving_flag.dds"

	group = je_group_historical_content

	is_shown_in_lobby = {
		c:JAP ?= THIS
	}

	is_shown_when_inactive = {
		c:JAP ?= THIS
		has_variable = meiji_var
	}

	possible = {
		AND = {
			custom_tooltip = {
				text = liberty_civil_right_support_above_5_tt
				any_political_movement = {
					is_political_movement_type = eafp_movement_liberty_civil_right
					political_movement_popular_support >= 0.05
				}
			}
			custom_tooltip = {
				text = liberty_civil_right_movement_above_15_tt
				any_political_movement = {
					is_political_movement_type = eafp_movement_liberty_civil_right
					political_movement_radicalism >= 0.15
				}
			}
		}
	}

	immediate = {
		hidden_effect = {
			create_political_lobby = {  
				type = lobby_anti_country  
				target = c:KOR
				add_interest_group = ig:ig_armed_forces
			}
		}
	}

	modifiers_while_active = {
		
	}

	complete = {
		has_law_or_variant = law_type:law_universal_suffrage
		has_law_or_variant = law_type:law_no_migration_controls
		has_law_or_variant = law_type:law_protected_speech
		NOT = { has_law_or_variant = law_type:law_no_womens_rights }
	}

	on_complete = {
		trigger_event = { id = liberty_civil_right_movement_events.1 popup = yes }
	}

	invalid = {

	}

	fail = {
		AND = {
			custom_tooltip = {
				text = liberty_civil_right_support_below_5_tt
				any_political_movement = {
					is_political_movement_type = eafp_movement_liberty_civil_right
					political_movement_popular_support <= 0.05
				}
			}
			custom_tooltip = {
				text = liberty_civil_right_radicalism_below_5_tt
				any_political_movement = {
					is_political_movement_type = eafp_movement_liberty_civil_right
					political_movement_radicalism <= 0.05
				}
			}
		}
		NOT = {
			any_political_movement = {
				is_insurrectionary = yes
			}
		}
	}

	on_fail = {
		trigger_event = { id = liberty_civil_right_movement_events.2 popup = yes }
	}

	on_monthly_pulse = {
		random_events = {
			200 = 0
			10 = liberty_civil_right_movement_events.3
			10 = liberty_civil_right_movement_events.4
			10 = liberty_civil_right_movement_events.5
			10 = liberty_civil_right_movement_events.6
			10 = liberty_civil_right_movement_events.7
			10 = liberty_civil_right_movement_events.8
			10 = liberty_civil_right_movement_events.9
		}
	}

	weight = 1000
	should_be_pinned_by_default = yes
}

# 정한론

je_seikanron = {
	icon = "gfx/interface/icons/event_icons/event_military.dds"

	group = je_group_historical_content

	is_shown_in_lobby = {
		c:JAP ?= THIS
	}

	is_shown_when_inactive = {
		c:JAP ?= THIS
		# 임시, 나중에 조건 바꾸기 TODO
		has_variable = meiji_var
	}

	possible = {
		any_political_lobby = {
			is_political_lobby_type = lobby_anti_country
			target = c:KOR
		}
	}

	immediate = {
		if = {
			limit = {
				ig:ig_armed_forces = {
					NOT = {
						any_political_lobby = {
							is_political_lobby_type = lobby_anti_country
							target = c:KOR
						}
					}
				}
			}
			random_political_lobby = {
				limit = {
					is_political_lobby_type = lobby_anti_country
					target = c:KOR
				}
				add_lobby_member = ig:ig_armed_forces
			}
		}
	}

	modifiers_while_active = {
		
	}

	complete = {
		NOT = { exists = c:KOR }
	}

	on_complete = {
		trigger_event = { id = seikanron_events.99 }
	}

	invalid = {
		NOT = {
			any_political_lobby = {
				is_political_lobby_type = lobby_anti_country
				target = c:KOR
			}
		}
	}

	fail = {
		any_political_lobby = {
			is_political_lobby_type = lobby_anti_country
			target = c:KOR
			appeasement <= -8
		}
	}

	on_fail = {
		
	}

	on_monthly_pulse = {
		random_events = {
			200 = 0
			10 = seikanron_events.2
			10 = seikanron_events.3
			10 = seikanron_events.4
			10 = seikanron_events.5
			10 = seikanron_events.6
			10 = seikanron_events.7
			10 = seikanron_events.8
			10 = seikanron_events.9
			10 = seikanron_events.13
			10 = seikanron_events.14
			10 = seikanron_events.15
		}
	}

	on_weekly_pulse = {
		events = {
			seikanron_events.1
		}
	}

	weight = 1000
	should_be_pinned_by_default = yes
}

# 신국가, 신종교

je_shinto = {
	icon = "gfx/interface/icons/religion_icons/shinto.dds"

	group = je_group_historical_content

	scripted_progress_bar = shinto_shinto_population_progress_bar
	scripted_progress_bar = shinto_faction_power_progress_bar
	scripted_progress_bar = shinto_shinto_buddism_balance_progress_bar

	immediate = {
		
	}

	modifiers_while_active = {
		national_edification_modifier
	}

	complete = {
		custom_tooltip = {
			text = je_shinto_complete_tt
			je:je_shinto = {
				"scripted_bar_progress(shinto_shinto_population_progress_bar)" >= 0.3
			}
		}
	}

	on_complete = {
		hidden_effect = {
			je:je_shinto = {
				save_scope_value_as = {
					name = shinto_faction_power_progress_bar_value
					value = "scripted_bar_progress(shinto_faction_power_progress_bar)"
				}
				save_scope_value_as = {
					name = shinto_shinto_buddism_balance_progress_bar_value
					value = "scripted_bar_progress(shinto_shinto_buddism_balance_progress_bar)"
				}
			}
		}
		trigger_event = { id = shinto_events.99 }
	}

	fail = {
		NOT = { country_has_state_religion = rel:shinto }
	}

	on_fail = {
	}

	on_monthly_pulse = {
	}

	on_weekly_pulse = {
	}

	weight = 1000
	should_be_pinned_by_default = no
}

# 재벌

je_zaibatsu = {
	icon = "gfx/interface/icons/ig_icons/industrialists.dds"

	group = je_group_historical_content

	is_shown_when_inactive = {
		c:JAP ?= THIS
		has_variable = meiji_var
	}

	possible = {
		c:JAP ?= THIS
		any_company = {
			is_zaibatsu_company = yes
		}
	}

	immediate = {
		hidden_effect = {
			ig:ig_industrialists = {
				set_interest_group_name = ig_zaibatsu
			}
		}
		trigger_event = { id = zaibatsu_events.1 }
	}

	modifiers_while_active = {
		zaibatsu_cooperation_modifier
	}

	complete = {
		
	}

	on_complete = {
		
	}
	
	fail = {
		NOR = {
			c:JAP ?= THIS
			OR = {
				has_company = company_type:company_mitsubishi
				has_company = company_type:company_mitsui
				has_company = company_type:company_sumitomo
			}
		}
	}

	on_fail = {
		hidden_effect = {
			ig:ig_industrialists = {
				set_interest_group_name = ig_industrialists
			}
		}
	}

	on_monthly_pulse = {
		random_events = {
			200 = 0
			10 = zaibatsu_events.2
			10 = zaibatsu_events.3
		}
	}

	on_weekly_pulse = {
		events = {
			
		}
	}

	weight = 1000
	should_be_pinned_by_default = yes
}

je_zaibatsu_petition_government = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	group = je_group_internal_affairs

	immediate = {
		set_variable = {
			name = zaibatsu_petition_government_var
			value = 0
		}
	}

	is_progressing = {
		market_capital.market = {
			mg:grain = { market_goods_cheaper >= 0.25 }
		}
	}

	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					ig:ig_industrialists ?= {
						is_in_government = yes
					}
				}
				change_variable = {
					name = zaibatsu_petition_government_var
					add = 1
				}
			}
		}
	}

	complete = {
		ig:ig_industrialists ?= {
			is_in_government = yes
		}
	}

	on_complete = {
		add_loyalists = {
			value = medium_radicals
			interest_group = ig:ig_industrialists
		}
		add_modifier = {
			name = modifier_successfully_met_petition_legitimacy
			days = long_modifier_time
			is_decaying = yes
		}
		remove_variable = zaibatsu_petition_government_var
	}

	invalid = { NOT = { has_journal_entry = je_zaibatsu } }

	on_invalid = { remove_variable = zaibatsu_petition_government_var }

	fail = {
		ig:ig_industrialists ?= {
			is_in_government = no
		}
	}

	on_timeout = {
		ig:ig_industrialists = {
			if = {
				limit = {
					is_powerful = yes
				}
				add_modifier = {
					name = modifier_failed_to_meet_petition
					days = long_modifier_time
					is_decaying = yes
					multiplier = 1.5
				}
			}
			else = {
				add_modifier = {
					name = modifier_failed_to_meet_petition
					days = long_modifier_time
					is_decaying = yes
				}
			}
		}
		remove_variable = zaibatsu_petition_government_var
	}

	on_fail = {
		ig:ig_industrialists = {
			add_modifier = {
				name = modifier_failed_to_meet_petition
				days = long_modifier_time
				is_decaying = yes
				multiplier = 2
			}
		}
		remove_variable = zaibatsu_petition_government_var
	}

	timeout = 1825

	current_value = {
		value = root.var:zaibatsu_petition_government_var
	}

	goal_add_value = {
		value = 60
	}

	progressbar = yes
	display_progressbar_as_months = yes

	weight = 1000

	should_be_pinned_by_default = yes
}

je_zaibatsu_petition_rice = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	group = je_group_internal_affairs

	immediate = {
		set_variable = {
			name = zaibatsu_petition_rice_var
			value = 0
		}
	}

	is_progressing = {
		market_capital.market = {
			mg:grain = { market_goods_cheaper >= 0.25 }
		}
	}

	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					market_capital.market = {
						mg:grain = { market_goods_cheaper >= 0.25 }
					}
				}
				change_variable = {
					name = zaibatsu_petition_rice_var
					add = 1
				}
			}
		}
	}

	complete = {
		market_capital.market = {
			mg:grain = { market_goods_cheaper >= 0.25 }
		}
	}

	on_complete = {
		add_loyalists = {
			value = medium_radicals
			interest_group = ig:ig_industrialists
		}
		add_modifier = {
			name = modifier_successfully_met_petition_legitimacy
			days = long_modifier_time
			is_decaying = yes
		}
		remove_variable = zaibatsu_petition_rice_var
	}

	invalid = { NOT = { has_journal_entry = je_zaibatsu } }

	on_invalid = { remove_variable = zaibatsu_petition_rice_var }

	fail = {
		ig:ig_industrialists ?= {
			is_in_government = no
		}
	}

	on_timeout = {
		ig:ig_industrialists = {
			if = {
				limit = {
					is_powerful = yes
				}
				add_modifier = {
					name = modifier_failed_to_meet_petition
					days = long_modifier_time
					is_decaying = yes
					multiplier = 1.5
				}
			}
			else = {
				add_modifier = {
					name = modifier_failed_to_meet_petition
					days = long_modifier_time
					is_decaying = yes
				}
			}
		}
		remove_variable = zaibatsu_petition_rice_var
	}

	on_fail = {
		ig:ig_industrialists = {
			add_modifier = {
				name = modifier_failed_to_meet_petition
				days = long_modifier_time
				is_decaying = yes
				multiplier = 2
			}
		}
		remove_variable = zaibatsu_petition_rice_var
	}

	timeout = 1825

	current_value = {
		value = root.var:zaibatsu_petition_rice_var
	}

	goal_add_value = {
		value = 60
	}

	progressbar = yes
	display_progressbar_as_months = yes

	weight = 1000

	should_be_pinned_by_default = yes
}

je_zaibatsu_petition_remove_monopoly = {
	icon = "gfx/interface/icons/event_icons/event_scales.dds"

	group = je_group_internal_affairs

	immediate = {
		set_variable = {
			name = zaibatsu_petition_remove_monopoly_var
			value = 0
		}
	}

	is_progressing = {
		country_has_country_monopoly = no
	}

	on_monthly_pulse = {
		effect = {
			if = {
				limit = {
					country_has_country_monopoly = no
				}
				change_variable = {
					name = zaibatsu_petition_remove_monopoly_var
					add = 1
				}
			}
		}
	}

	complete = {
		country_has_country_monopoly = no
	}

	on_complete = {
		add_loyalists = {
			value = medium_radicals
			interest_group = ig:ig_industrialists
		}
		add_modifier = {
			name = modifier_successfully_met_petition_legitimacy
			days = long_modifier_time
			is_decaying = yes
		}
		remove_variable = zaibatsu_petition_remove_monopoly_var
	}

	invalid = { NOT = { has_journal_entry = je_zaibatsu } }

	on_invalid = { remove_variable = zaibatsu_petition_remove_monopoly_var }

	fail = {
		ig:ig_industrialists ?= {
			is_in_government = no
		}
	}

	on_timeout = {
		ig:ig_industrialists = {
			if = {
				limit = {
					is_powerful = yes
				}
				add_modifier = {
					name = modifier_failed_to_meet_petition
					days = long_modifier_time
					is_decaying = yes
					multiplier = 1.5
				}
			}
			else = {
				add_modifier = {
					name = modifier_failed_to_meet_petition
					days = long_modifier_time
					is_decaying = yes
				}
			}
		}
		remove_variable = zaibatsu_petition_remove_monopoly_var
	}

	on_fail = {
		ig:ig_industrialists = {
			add_modifier = {
				name = modifier_failed_to_meet_petition
				days = long_modifier_time
				is_decaying = yes
				multiplier = 2
			}
		}
		remove_variable = zaibatsu_petition_remove_monopoly_var
	}

	timeout = 1825

	current_value = {
		value = root.var:zaibatsu_petition_remove_monopoly_var
	}

	goal_add_value = {
		value = 60
	}

	progressbar = yes
	display_progressbar_as_months = yes

	weight = 1000

	should_be_pinned_by_default = yes
}

# 류큐 처분: 중국이랑 딜 보는 컨텐츠

je_ryukyu_disposition = {
	icon = "gfx/interface/icons/event_icons/waving_flag.dds"

	group = je_group_historical_content

	is_shown_when_inactive = {
		c:JAP ?= THIS
		exists = c:CHI
		c:RYU ?= {
			is_subject_of = c:JAP
		}
		NOT = {
			has_global_variable = china_shatters
		}
	}

	possible = {
		c:JAP ?= THIS
		exists = c:CHI
		c:RYU ?= {
			is_subject_of = c:JAP
		}
		any_diplomatic_play = {
			initiator_is = c:JAP
			target_is = c:RYU
			has_play_goal = annex_country
		}
		NOT = {
			has_global_variable = china_shatters
		}
	}

	immediate = {
		c:CHI = { add_journal_entry = { type = je_ryukyu_disposition_chi } }
		c:RYU = { save_scope_as = RYU_scope }
		c:CHI = { save_scope_as = CHI_scope }
	}

	complete = {
		
	}

	on_complete = {
		
	}
	
	fail = {
		OR = {
			NOT = { exists = c:JAP }
			NOT = { exists = c:CHI }
			NOT = {
				c:RYU ?= {
					is_subject_of = c:JAP
				}
			}
			NOT = {
				any_diplomatic_play = {
					initiator_is = c:JAP
					target_is = c:RYU
					has_play_goal = annex_country
				}
			}
			custom_tooltip = {
				text = china_shatters_tt
				has_global_variable = china_shatters
			}
		}
	}

	on_monthly_pulse = {
		
	}

	on_weekly_pulse = {
		effect = {
			
		}
	}

	weight = 1000
	should_be_pinned_by_default = yes
}

je_ryukyu_disposition_chi = {
	icon = "gfx/interface/icons/event_icons/waving_flag.dds"

	group = je_group_historical_content

	immediate = {
		c:RYU = { save_scope_as = RYU_scope }
		c:JAP = { save_scope_as = JAP_scope }
	}

	complete = {
		
	}

	on_complete = {
		
	}
	
	fail = {
		OR = {
			NOT = { exists = c:JAP }
			NOT = { exists = c:CHI }
			NOT = {
				c:RYU ?= {
					is_subject_of = c:JAP
				}
			}
			NOT = {
				any_diplomatic_play = {
					initiator_is = c:JAP
					target_is = c:RYU
					has_play_goal = annex_country
				}
			}
			custom_tooltip = {
				text = china_shatters_tt
				has_global_variable = china_shatters
			}
		}
	}

	on_monthly_pulse = {
		
	}

	on_weekly_pulse = {
		effect = {
			
		}
	}

	weight = 1000
	should_be_pinned_by_default = yes
}

# 가라후토 개척: 러시아랑 딜 보는 컨텐츠

je_karafuto = {
	icon = "gfx/interface/icons/law_icons/frontier_colonization.dds"

	group = je_group_historical_content

	is_shown_when_inactive = {
		c:JAP ?= THIS
		has_state_in_state_region = STATE_HOKKAIDO
	}

	possible = {
		has_state_in_state_region = STATE_SAKHALIN
	}

	immediate = {
		if = {
			limit = {
				c:RUS ?= { has_state_in_state_region = STATE_SAKHALIN }
			}
			trigger_event = karafuto_events.1
		}
	}

	complete = {
		s:STATE_SAKHALIN = {
			NOT = {
				any_scope_state = {
					is_under_colonization = yes
				}
			}
		}
	}

	on_complete = {
		
	}

	on_monthly_pulse = {
		random_events = {
			90 = 0
			10 = karafuto_events.1
		}
	}

	weight = 1000
	should_be_pinned_by_default = yes
}

# 일본의 대만 원정

je_formosa_expedition = {
	icon = "gfx/interface/icons/law_icons/frontier_colonization.dds"

	group = je_group_historical_content

	is_shown_when_inactive = {
		c:JAP ?= THIS
	}

	possible = {
		c:JAP ?= THIS
		has_state_in_state_region = STATE_RYUKYU_ISLANDS
	}

	scripted_button = start_formosa_survey_button
	scripted_button = pause_formosa_survey_button

	scripted_progress_bar = formosa_survey_progress_bar

	immediate = {
		
	}

	complete = {
		owns_entire_state_region = STATE_FORMOSA
	}

	on_complete = {
		trigger_event = formosa_expedition_events.1
	}

	on_weekly_pulse = {
		effect = {
			if = {
				limit = {
					scope:journal_entry = {
						"scripted_bar_progress(formosa_survey_progress_bar)" > 24
					}
				}
				trigger_event = formosa_expedition_events.2
				s:STATE_FORMOSA = {
					add_claim = ROOT
				}
			}
			if = {
				limit = {
					has_claim = s:STATE_FORMOSA
					has_modifier = formosa_survey_modifier
				}
				remove_modifier = formosa_survey_modifier
			}
		}
	}

	weight = 1000
	should_be_pinned_by_default = yes
}