je_manchus_and_han = {
	icon = "gfx/interface/icons/event_icons/event_portrait.dds"
	
	group = je_group_historical_content

	scripted_button = decree_examinations_manchu_button
	scripted_button = decree_examinations_han_button
	scripted_button = promote_officials_manchu_button
	scripted_button = promote_officials_han_button
	scripted_button = grant_money_manchu_button
	scripted_button = grant_money_han_button

	immediate = {
		# 가능한 특권들
		# 만결
		add_to_variable_list = {
			name = chi_manchu_privileges
			target = flag:chi_manchu_vacancies
		}

		add_to_variable_list = {
			name = chi_manchu_vacancies_list
			target = flag:chi_manchu_vacancies_1
		}
		add_to_variable_list = {
			name = chi_manchu_vacancies_list
			target = flag:chi_manchu_vacancies_2
		}
		add_to_variable_list = {
			name = chi_manchu_vacancies_list
			target = flag:chi_manchu_vacancies_3
		}
		add_to_variable_list = {
			name = chi_manchu_vacancies_list
			target = flag:chi_manchu_vacancies_4
		}

		set_variable = {
			name = chi_manchu_vacancies_1
			value = flag:chi_manchu_vacancies
		}
		set_variable = {
			name = chi_manchu_vacancies_2
			value = flag:chi_manchu_vacancies
		}
		set_variable = {
			name = chi_manchu_vacancies_3
			value = flag:chi_manchu_vacancies
		}
		set_variable = {
			name = chi_manchu_vacancies_4
			value = flag:chi_manchu_vacancies
		}

		#만성
		add_to_variable_list = {
			name = chi_manchu_privileges
			target = flag:chi_manchu_cities
		}

		add_to_variable_list = {
			name = chi_manchu_cities_list
			target = flag:chi_manchu_cities_1
		}
		add_to_variable_list = {
			name = chi_manchu_cities_list
			target = flag:chi_manchu_cities_2
		}
		add_to_variable_list = {
			name = chi_manchu_cities_list
			target = flag:chi_manchu_cities_3
		}

		set_variable = {
			name = chi_manchu_cities_1
			value = flag:chi_manchu_cities
		}
		set_variable = {
			name = chi_manchu_cities_2
			value = flag:chi_manchu_cities
		}
		set_variable = {
			name = chi_manchu_cities_3
			value = flag:chi_manchu_cities
		}

		#팔기군
		add_to_variable_list = {
			name = chi_manchu_privileges
			target = flag:chi_banner_armies
		}

		add_to_variable_list = {
			name = chi_banner_armies_list
			target = flag:chi_banner_armies_1
		}
		add_to_variable_list = {
			name = chi_banner_armies_list
			target = flag:chi_banner_armies_2
		}
		add_to_variable_list = {
			name = chi_banner_armies_list
			target = flag:chi_banner_armies_3
		}
		add_to_variable_list = {
			name = chi_banner_armies_list
			target = flag:chi_banner_armies_4
		}

		set_variable = {
			name = chi_banner_armies_1
			value = flag:chi_banner_armies
		}
		set_variable = {
			name = chi_banner_armies_2
			value = flag:chi_banner_armies
		}
		set_variable = {
			name = chi_banner_armies_3
			value = flag:chi_banner_armies
		}
		set_variable = {
			name = chi_banner_armies_4
			value = flag:chi_banner_armies
		}

		#기인 봉급
		add_to_variable_list = {
			name = chi_manchu_privileges
			target = flag:chi_banner_subsidies
		}

		add_to_variable_list = {
			name = chi_banner_subsidies_list
			target = flag:chi_banner_subsidies_1
		}
		add_to_variable_list = {
			name = chi_banner_subsidies_list
			target = flag:chi_banner_subsidies_2
		}
		add_to_variable_list = {
			name = chi_banner_subsidies_list
			target = flag:chi_banner_subsidies_3
		}
		add_to_variable_list = {
			name = chi_banner_subsidies_list
			target = flag:chi_banner_subsidies_4
		}

		set_variable = {
			name = chi_banner_subsidies_1
			value = flag:chi_banner_subsidies
		}
		set_variable = {
			name = chi_banner_subsidies_2
			value = flag:chi_banner_subsidies
		}
		set_variable = {
			name = chi_banner_subsidies_3
			value = flag:chi_banner_subsidies
		}
		set_variable = {
			name = chi_banner_subsidies_4
			value = flag:chi_banner_subsidies
		}

		#만화 정책
		add_to_variable_list = {
			name = chi_manchu_privileges
			target = flag:chi_manchurianization_policies
		}

		add_to_variable_list = {
			name = chi_manchurianization_policies_list
			target = flag:chi_manchurianization_policies_1
		}
		add_to_variable_list = {
			name = chi_manchurianization_policies_list
			target = flag:chi_manchurianization_policies_2
		}
		add_to_variable_list = {
			name = chi_manchurianization_policies_list
			target = flag:chi_manchurianization_policies_3
		}

		set_variable = {
			name = chi_manchurianization_policies_1
			value = flag:chi_manchurianization_policies
		}
		set_variable = {
			name = chi_manchurianization_policies_2
			value = flag:chi_manchurianization_policies
		}
		set_variable = {
			name = chi_manchurianization_policies_3
			value = flag:chi_manchurianization_policies
		}

		# 현재 가지고 있는 특권들
		set_variable = {
			name = chi_manchu_vacancies_var
			value = flag:chi_manchu_vacancies_3
		}
		set_variable = {
			name = chi_manchu_cities_var
			value = flag:chi_manchu_cities_3
		}
		set_variable = {
			name = chi_banner_armies_var
			value = flag:chi_banner_armies_4
		}
		set_variable = {
			name = chi_banner_subsidies_var
			value = flag:chi_banner_subsidies_3
		}
		set_variable = {
			name = chi_manchurianization_policies_var
			value = flag:chi_manchurianization_policies_3
		}

		add_modifier = chi_manchu_vacancies_3_modifier
		add_modifier = chi_manchu_cities_3_modifier
		add_modifier = chi_banner_armies_4_modifier
		add_modifier = chi_banner_subsidies_3_modifier
		add_modifier = chi_manchurianization_policies_3_modifier

		# 권력 지지 초기값 설정
		set_variable = {
			name = china_manchu_support_var
			value = 0.85
		}
		set_variable = {
			name = china_han_support_var
			value = 0.15
		}
		set_variable = {
			name = china_manchu_power_var
			value = 0.68
		}
		set_variable = {
			name = china_han_power_var
			value = 0.32
		}

		je_manchus_and_han_d_var_calc = yes
		je_manchus_and_han_modifier_calc = yes
		cu:manchu = {
			save_scope_as = manchu_scope
		}
		cu:han = {
			save_scope_as = han_scope
		}

		trigger_event = {
			id = manchus_and_han_events.1
			days = 1
		}
	}

	invalid = {
		custom_tooltip = {
			text = china_shatters_tt
			has_global_variable = china_shatters
		}
	}

	on_invalid = {
		clear_je_manchu_and_han_stuffs = yes
	}

	complete = {
		NOT = { has_law = law_type:law_racial_segregation }
	}

	on_complete = {
		clear_je_manchu_and_han_stuffs = yes
	}
	
	modifiers_while_active = {
		manchu_above_all
	}

	on_weekly_pulse = {
		effect = {
			je_manchus_and_han_d_var_calc = yes
			je_manchus_and_han_modifier_calc = yes
		}
	}

	on_monthly_pulse = {
		effect = {
			je_manchus_and_han_d_var_calc = yes

			#################### 지지도 계산 ####################
			change_variable = {
				name = china_manchu_support_var
				add = {
					value = var:china_manchu_support_d_var
					add = modifier:country_china_manchu_support_monthly_add
				}
			}
			change_variable = {
				name = china_han_support_var
				add = {
					value = var:china_han_support_d_var
					add = modifier:country_china_han_support_monthly_add
				}
			}

			#################### 권력 계산 ####################
			change_variable = {
				name = china_manchu_power_var
				add = {
					value = var:china_manchu_power_d_var
					add = modifier:country_china_manchu_power_monthly_add
				}
			}
			change_variable = {
				name = china_han_power_var
				add = {
					value = var:china_han_power_d_var
					subtract = modifier:country_china_manchu_power_monthly_add
				}
			}

			je_manchus_and_han_modifier_calc = yes
		}
	}

	on_yearly_pulse = {
		effect = {
			if = {
				limit = {
					has_technology_researched = nationalism
					NOT = { has_variable = manhan1 }
				}
				set_variable = manhan1
				trigger_event = {
					id = manchus_and_han_events.101
					months = { 0 12 }
				}
			}
			if = {
				limit = {
					has_technology_researched = pan-nationalism
					NOT = { has_variable = manhan2 }
				}
				set_variable = manhan2
				trigger_event = {
					id = manchus_and_han_events.102
					months = { 12 60 }
				}
			}
			if = {
				limit = { has_variable = manhan1 }
				random_list = {
					40 = {}
					5 = {
						modifier = {
							if = {
								limit = { cu:han = { culture_is_discriminated_in = ROOT } }
								multiply = 2
							}
						}
						modifier = {
							if = {
								limit = { has_variable = manhan2 }
								multiply = 2
							}
						}
						modifier = {
							if = {
								limit = { has_law = law_type:law_landed_voting }
								multiply = 0.9
							}
						}
						modifier = {
							if = {
								limit = { has_law = law_type:law_census_voting }
								multiply = 0.8
							}
						}
						modifier = {
							if = {
								limit = { has_law = law_type:law_wealth_voting }
								multiply = 0.7
							}
						}
						modifier = {
							if = {
								limit = { has_law = law_type:law_universal_suffrage }
								multiply = 0.6
							}
						}
						trigger_event = {
							id = manchus_and_han_events.103
							months = { 0 12 }
						}
					}
				}
			}
		}
	}

	progress_desc = je_manchus_and_han_progress

	weight = 1000
	should_be_pinned_by_default = no
}
