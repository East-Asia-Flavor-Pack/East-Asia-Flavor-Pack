



####################################################################################

change_kaikakuha_var_effect_internal = {
	change_variable = {
		name = hitotsubashiha_var
		add = $AMOUNT$
	}
}

change_kaikakuha_var_effect = {
	if = {
		limit = {
			NOT = { has_variable = yoshinobu_start }
			$AMOUNT$ >= 5
		}
		change_kaikakuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = increase_extremely_kaikakuha_var_effect_tt
	}
	else_if = {
		limit = {
			has_variable = yoshinobu_start
			$AMOUNT$ >= 5
		}
		change_kaikakuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = increase_extremely_hitotsubashiha_var_effect_tt
	}
	else_if = {
		limit = {
			$AMOUNT$ < 5
            $AMOUNT$ >= 3
			NOT = { has_variable = yoshinobu_start }
		}
		change_kaikakuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = increase_greatly_kaikakuha_var_effect_tt
	}
	else_if = {
		limit = {
			$AMOUNT$ < 5
            $AMOUNT$ >= 3
			has_variable = yoshinobu_start
		}
		change_kaikakuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = increase_greatly_hitotsubashiha_var_effect_tt
	}
	else_if = {
		limit = {
            $AMOUNT$ < 3
			$AMOUNT$ > 0
			NOT = { has_variable = yoshinobu_start }
		}
		change_kaikakuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = increase_kaikakuha_var_effect_tt
	}
	else_if = {
		limit = {
			$AMOUNT$ < 3
            $AMOUNT$ > 0
			has_variable = yoshinobu_start
		}
		change_kaikakuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = increase_hitotsubashiha_var_effect_tt
	}
	else_if = {
		limit = {
            $AMOUNT$ < 0
			$AMOUNT$ >= -3
			NOT = { has_variable = yoshinobu_start }
		}
		change_kaikakuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = decrease_kaikakuha_var_effect_tt
	}
	else_if = {
		limit = {
			$AMOUNT$ < 0
            $AMOUNT$ >= -3
			has_variable = yoshinobu_start
		}
		change_kaikakuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = decrease_hitotsubashiha_var_effect_tt
	}
	else_if = {
		limit = {
            $AMOUNT$ < -3
			$AMOUNT$ >= -5
			NOT = { has_variable = yoshinobu_start }
		}
		change_kaikakuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = decrease_greatly_kaikakuha_var_effect_tt
	}
	else_if = {
		limit = {
			$AMOUNT$ < -3
			$AMOUNT$ >= -5
			has_variable = yoshinobu_start
		}
		change_kaikakuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = decrease_greatly_hitotsubashiha_var_effect_tt
	}
	else_if = {
		limit = {
			$AMOUNT$ < -5
			NOT = { has_variable = yoshinobu_start }
		}
		change_kaikakuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = decrease_extremely_kaikakuha_var_effect_tt
	}
	else_if = {
		limit = {
			$AMOUNT$ < -5
			has_variable = yoshinobu_start
		}
		change_kaikakuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = decrease_extremely_hitotsubashiha_var_effect_tt
	}
}

change_hoshuha_var_effect_internal = {
	change_variable = {
		name = nankiha_var
		add = $AMOUNT$
	}
}

change_hoshuha_var_effect = {
	if = {
		limit = {
			NOT = { has_variable = yoshinobu_start }
			$AMOUNT$ >= 5
		}
		change_hoshuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = increase_extremely_hoshuha_var_effect_tt
	}
	else_if = {
		limit = {
			has_variable = yoshinobu_start
			$AMOUNT$ >= 5
		}
		change_hoshuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = increase_extremely_nankiha_var_effect_tt
	}
	else_if = {
		limit = {
			$AMOUNT$ < 5
            $AMOUNT$ >= 3
			NOT = { has_variable = yoshinobu_start }
		}
		change_hoshuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = increase_greatly_hoshuha_var_effect_tt
	}
	else_if = {
		limit = {
			$AMOUNT$ < 5
            $AMOUNT$ >= 3
			has_variable = yoshinobu_start
		}
		change_hoshuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = increase_greatly_nankiha_var_effect_tt
	}
	else_if = {
		limit = {
            $AMOUNT$ < 3
			$AMOUNT$ > 0
			NOT = { has_variable = yoshinobu_start }
		}
		change_hoshuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = increase_hoshuha_var_effect_tt
	}
	else_if = {
		limit = {
			$AMOUNT$ < 3
            $AMOUNT$ > 0
			has_variable = yoshinobu_start
		}
		change_hoshuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = increase_nankiha_var_effect_tt
	}
	else_if = {
		limit = {
            $AMOUNT$ < 0
			$AMOUNT$ >= -3
			NOT = { has_variable = yoshinobu_start }
		}
		change_hoshuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = decrease_hoshuha_var_effect_tt
	}
	else_if = {
		limit = {
			$AMOUNT$ < 0
            $AMOUNT$ >= -3
			has_variable = yoshinobu_start
		}
		change_hoshuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = decrease_nankiha_var_effect_tt
	}
	else_if = {
		limit = {
            $AMOUNT$ < -3
			$AMOUNT$ >= -5
			NOT = { has_variable = yoshinobu_start }
		}
		change_hoshuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = decrease_greatly_hoshuha_var_effect_tt
	}
	else_if = {
		limit = {
			$AMOUNT$ < -3
			$AMOUNT$ >= -5
			has_variable = yoshinobu_start
		}
		change_hoshuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = decrease_greatly_nankiha_var_effect_tt
	}
	else_if = {
		limit = {
			$AMOUNT$ < -5
			NOT = { has_variable = yoshinobu_start }
		}
		change_hoshuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = decrease_extremely_hoshuha_var_effect_tt
	}
	else_if = {
		limit = {
			$AMOUNT$ < -5
			has_variable = yoshinobu_start
		}
		change_hoshuha_var_effect_internal = {
			AMOUNT = $AMOUNT$
		}
		custom_tooltip = decrease_extremely_nankiha_var_effect_tt
	}
}

weekly_pulse_hitotsubashiha_progress = { 
	set_variable = { name = hitotsubashiha_progress_from_button value = 0 }
	set_variable = { name = hitotsubashiha_progress_from_igs value = 0 }
	set_variable = { name = hitotsubashiha_progress_from_building value = 0 }
	set_variable = { name = hitotsubashiha_progress_next value = 0 }
	
	ig:ig_intelligentsia = {
		ROOT = {
			set_variable = { name = ig_weight value = prev.ig_clout } 
		}
		if = {
			limit = {
				is_in_government = yes
			}
			ROOT = {
				change_variable = { name = ig_weight multiply = 3 }	
			}
		}
		else = {
			ROOT = {
				change_variable = { name = ig_weight multiply = 0.5 }	
			}
		}
		ROOT = {
			change_variable = { name = hitotsubashiha_progress_from_igs add = var:ig_weight }
		}
	}
	
	every_scope_building = { 
		limit = {
			is_building_type = building_university
			occupancy >= 0.5
		}
		ROOT = {
			change_variable = { name = hitotsubashiha_progress_from_building add = prev.level }
		}
	}
	change_variable = { name = hitotsubashiha_progress_from_building divide = 100 } 

	if = {
		limit = {
			has_variable = supporting_hitotsubashiha_var
		}
		change_variable = { name = hitotsubashiha_progress_from_button add = 0.1 } 
	}

	change_variable = { name = hitotsubashiha_progress_next add = var:hitotsubashiha_progress_from_igs }
	change_variable = { name = hitotsubashiha_progress_next add = var:hitotsubashiha_progress_from_building }
	change_variable = { name = hitotsubashiha_progress_next add = var:hitotsubashiha_progress_from_button }
	change_variable = { name = hitotsubashiha_progress_next add = var:hitotsubashiha_progress_from_effects }
}

weekly_pulse_nankiha_progress = { 
	set_variable = { name = nankiha_progress_from_button value = 0 }
	set_variable = { name = nankiha_progress_from_igs value = 0 }
	set_variable = { name = nankiha_progress_from_character value = 0 }
	set_variable = { name = nankiha_progress_next value = 0 }
	
	ig:ig_petty_bourgeoisie = {
		ROOT = {
			set_variable = { name = ig_weight value = prev.ig_clout } 
		}
		if = {
			limit = {
				is_in_government = yes
			}
			ROOT = {
				change_variable = { name = ig_weight multiply = 5 }	
			}
		}
		else = {
			ROOT = {
				change_variable = { name = ig_weight multiply = 1 }	
			}
		}
		ROOT = {
			change_variable = { name = nankiha_progress_from_igs add = var:ig_weight }
		}
	}
	
	ruler = {
		limit = {
			has_template = jap_ienari_tokugawa_template
		}
		ROOT = {
			change_variable = { name = nankiha_progress_from_character add = prev.popularity }
		}
	}
	change_variable = { name = nankiha_progress_from_character divide = 50 }

	if = {
		limit = {
			has_variable = nankiha_button_var
		}
		change_variable = { name = nankiha_progress_from_button add = 0.1 } 
	}
	
	change_variable = { name = nankiha_progress_next add = var:nankiha_progress_from_igs }
	change_variable = { name = nankiha_progress_next add = var:nankiha_progress_from_character }
	change_variable = { name = nankiha_progress_next add = var:nankiha_progress_from_button }
	change_variable = { name = nankiha_progress_next add = var:nankiha_progress_from_effects }
}

weekly_pulse_hitotsubashiha_progress_second = { 
	set_variable = { name = hitotsubashiha_progress_from_button value = 0 }
	set_variable = { name = hitotsubashiha_progress_from_daimyo value = 0 }
	set_variable = { name = hitotsubashiha_progress_from_university value = 0 }
	set_variable = { name = hitotsubashiha_progress_next value = 0 }
	
	every_scope_building = { 
		limit = {
			is_building_type = building_university
			occupancy >= 0.5
		}
		ROOT = {
			change_variable = { name = hitotsubashiha_progress_from_university add = prev.level }
		}
	}
	change_variable = { name = hitotsubashiha_progress_from_university divide = 100 } 

	change_variable = { name = hitotsubashiha_progress_from_daimyo add = 400 } 
	change_variable = { name = hitotsubashiha_progress_from_daimyo divide = 400 } 
	
	if = {
		limit = {
			has_variable = supporting_hitotsubashiha_var
		}
		change_variable = { name = hitotsubashiha_progress_from_button add = 0.3 } 
	}

	change_variable = { name = hitotsubashiha_progress_next add = var:hitotsubashiha_progress_from_daimyo }
	change_variable = { name = hitotsubashiha_progress_next add = var:hitotsubashiha_progress_from_university }
	change_variable = { name = hitotsubashiha_progress_next add = var:hitotsubashiha_progress_from_button }
	change_variable = { name = hitotsubashiha_progress_next add = var:hitotsubashiha_progress_from_effects }
}

weekly_pulse_nankiha_progress_second = { 
	set_variable = { name = nankiha_progress_from_button value = 0 }
	set_variable = { name = nankiha_progress_from_daimyo value = 0 }
	set_variable = { name = nankiha_progress_from_military value = 0 }
	set_variable = { name = nankiha_progress_next value = 0 }
	
	every_scope_building = { 
		limit = {
			is_building_group = bg_military
			occupancy >= 0.5
		}
		ROOT = {
			change_variable = { name = nankiha_progress_from_military add = prev.level }
		}
	}
	change_variable = { name = nankiha_progress_from_military divide = 200 } 

	change_variable = { name = nankiha_progress_from_daimyo add = 400 } 
	change_variable = { name = nankiha_progress_from_daimyo divide = 400 } 
	
	if = {
		limit = {
			has_variable = supporting_nankiha_var
		}
		change_variable = { name = nankiha_progress_from_button add = 0.1 } 
	}

	change_variable = { name = nankiha_progress_next add = var:nankiha_progress_from_daimyo }
	change_variable = { name = nankiha_progress_next add = var:nankiha_progress_from_military }
	change_variable = { name = nankiha_progress_next add = var:nankiha_progress_from_button }
	change_variable = { name = nankiha_progress_next add = var:nankiha_progress_from_effects }
}

clear_habatsu = {
	remove_variable = nankiha_progress_next
	remove_variable = nankiha_progress_from_character
	remove_variable = nankiha_progress_from_button
	remove_variable = nankiha_progress_from_effects
	remove_variable = nankiha_progress_from_igs
	remove_variable = nankiha_progress_from_daimyo
	remove_variable = nankiha_progress_from_military
	remove_variable = hitotsubashiha_progress_next 
	remove_variable = hitotsubashiha_progress_from_igs
	remove_variable = hitotsubashiha_progress_from_building
	remove_variable = hitotsubashiha_progress_from_university
	remove_variable = hitotsubashiha_progress_from_daimyo
	remove_variable = hitotsubashiha_progress_from_button
	remove_variable = hitotsubashiha_progress_from_effect
	remove_variable = orleanist_progress_from_effects 
	remove_variable = ig_weight 
}


tobaku_tokuritsu_first = {
	clear_global_variable_list = tobaku_list
	set_global_variable = tobaku_start_var
	trigger_event = {
		id = boshin_war.1 # 대충 반란 함
	}
}


tobaku_tokuritsu_second = {
	trigger_event = { id = boshin_war.2 } # 대충 반란 함
}



tobaku_tokuritsu_third = {

	trigger_event = { id = boshin_war.3 } # 대충 반란 함
}

tobaku_kuni_0 = {
	random_in_global_list = {
		variable = tobaku_list
		change_tag = NIP
	}
}

tobaku_kuni = {
	
	c:NIP = {
		remove_list_global_variable = {
			name = tobaku_list
			target = this	
		}
	}
	every_in_global_list = {
		variable = tobaku_list
		limit = {
			not = { c:NIP = this }
		}
		c:NIP = {
			annex = prev
		}
	}
	c:NIP = {
		add_technology_researched = napoleonic_warfare
		add_technology_researched = general_staff
	}
}

tobaku_kuni_2 = {
	c:NIP = {
		remove_variable = tobaku_han_var 
	}
}



japan_create_character = {
	create_character = { template = eafp_shimazu_nariakira on_created = { set_variable = figure_var place_character_in_void = 1200 } }
}